# 🏛️ 申訴機制詳細規劃

## 📋 功能概述
實現投票結果申訴和撤銷功能，確保公平公正的人事決策流程。

## 🔧 數據模型設計

### VoteAppeal (申訴記錄表)
```javascript
{
  id: INTEGER (主鍵),
  campaignId: INTEGER (投票活動ID),
  appealingEmployeeId: INTEGER (申訴人ID),
  targetEmployeeId: INTEGER (被申訴決定影響的員工ID),
  appealType: ENUM('promotion_result', 'demotion_result', 'vote_manipulation', 'unfair_process'),
  appealReason: TEXT (申訴理由),
  appealStatus: ENUM('pending', 'under_review', 'approved', 'rejected', 'withdrawn'),
  appealSubmittedAt: DATE (申訴提交時間),
  appealDeadline: DATE (申訴截止時間),
  reviewedBy: INTEGER (審核人員ID),
  reviewedAt: DATE (審核時間),
  reviewNotes: TEXT (審核備註),
  reviewDecision: TEXT (審核決定說明),
  originalResult: JSON (原始投票結果),
  appealOutcome: ENUM('maintain_result', 'revote', 'direct_override', 'position_restored'),
  evidenceFiles: JSON (證據文件列表),
  supportingEmployees: JSON (支持申訴的員工列表),
  createdAt: DATE,
  updatedAt: DATE
}
```

## 📝 業務規則邏輯

### 🕒 申訴時間限制
```javascript
const APPEAL_RULES = {
  // 申訴期限
  appealDeadlineDays: 7, // 投票結果公布後7天內
  
  // 申訴資格
  eligibleAppealants: [
    'vote_target', // 被投票對象本人
    'direct_supervisor', // 直屬上級
    'store_manager', // 店長
    'any_employee' // 任何員工 (針對程序不當)
  ],
  
  // 申訴類型限制
  appealTypeRules: {
    'promotion_result': {
      eligibleUsers: ['vote_target', 'direct_supervisor'],
      requiredEvidence: true,
      autoReviewDays: 3
    },
    'demotion_result': {
      eligibleUsers: ['vote_target', 'direct_supervisor', 'store_manager'],
      requiredEvidence: true,
      autoReviewDays: 2 // 降職申訴優先處理
    },
    'vote_manipulation': {
      eligibleUsers: ['any_employee'],
      requiredEvidence: true,
      autoReviewDays: 1 // 操縱投票緊急處理
    },
    'unfair_process': {
      eligibleUsers: ['vote_target', 'any_employee'],
      requiredEvidence: false,
      autoReviewDays: 5
    }
  }
}
```

### 🔍 申訴審核流程
```javascript
const APPEAL_WORKFLOW = {
  // 階段1: 申訴提交
  submission: {
    validation: [
      '檢查申訴期限',
      '驗證申訴人資格', 
      '確認申訴類型',
      '檢查證據完整性'
    ],
    autoActions: [
      '暫停執行原投票結果',
      '通知相關人員',
      '創建審核任務'
    ]
  },
  
  // 階段2: 初步審核
  initialReview: {
    reviewer: '人事主管',
    timeLimit: 72, // 小時
    decisions: ['accept_for_review', 'reject_insufficient', 'require_more_evidence']
  },
  
  // 階段3: 詳細調查
  investigation: {
    actions: [
      '重新檢視投票記錄',
      '訪談相關人員',
      '核實證據材料',
      '分析投票模式'
    ],
    timeLimit: 168 // 7天
  },
  
  // 階段4: 決定執行
  finalDecision: {
    outcomes: {
      'maintain_result': '維持原結果',
      'revote': '重新投票',
      'direct_override': '直接推翻決定',
      'position_restored': '恢復原職位'
    }
  }
}
```

## 🛡️ 防範濫用機制

### 申訴頻率限制
```javascript
const ABUSE_PREVENTION = {
  // 個人申訴限制
  personalLimits: {
    maxAppealsPerMonth: 2,
    maxAppealsPerCampaign: 1,
    cooldownPeriodDays: 30
  },
  
  // 惡意申訴檢測
  maliciousDetection: {
    indicators: [
      '連續多次申訴被駁回',
      '申訴理由重複或空洞',
      '缺乏證據支撐',
      '申訴時間過於接近'
    ],
    penalties: [
      'warning', // 警告
      'appeal_restriction', // 限制申訴權
      'disciplinary_action' // 紀律處分
    ]
  }
}
```

## 📊 申訴統計和監控

### 關鍵指標
```javascript
const APPEAL_METRICS = {
  // 申訴率統計
  appealRate: {
    formula: '申訴案件數 / 總投票活動數',
    healthyRange: '<10%',
    warningRange: '10-20%',
    criticalRange: '>20%'
  },
  
  // 申訴成功率
  successRate: {
    formula: '申訴成功數 / 總申訴數',
    healthyRange: '20-40%', // 過低表示申訴門檻過高，過高表示投票品質差
  },
  
  // 處理效率
  processingTime: {
    target: '<7天',
    sla: '<14天'
  }
}
```