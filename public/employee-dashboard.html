<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å“¡å·¥å·¥ä½œå° - ä¼æ¥­å“¡å·¥ç®¡ç†ç³»çµ±</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <script type="text/javascript">
        // ğŸ” å“¡å·¥é é¢èªè­‰é©—è­‰ç³»çµ±
        (function() {
            'use strict';
            
            console.log('ğŸ” å•Ÿå‹•å“¡å·¥é é¢èªè­‰æª¢æŸ¥...');
            
            // æª¢æŸ¥èªè­‰ç‹€æ…‹
            function checkAuthentication() {
                const token = localStorage.getItem('employeeToken') || sessionStorage.getItem('employeeToken');
                const employeeData = localStorage.getItem('employeeData') || sessionStorage.getItem('employeeData');
                
                console.log('ğŸ” æª¢æŸ¥èªè­‰ç‹€æ…‹:', { 
                    hasToken: !!token, 
                    hasEmployeeData: !!employeeData 
                });
                
                if (!token || !employeeData) {
                    console.log('âŒ èªè­‰å¤±æ•—: æœªæ‰¾åˆ°æœ‰æ•ˆçš„ç™»å…¥æ†‘è­‰');
                    
                    // é¡¯ç¤ºèªè­‰å¤±æ•—è¨Šæ¯
                    showAuthenticationAlert();
                    
                    // 3ç§’å¾Œé‡å®šå‘åˆ°ç™»å…¥é é¢
                    setTimeout(() => {
                        console.log('ğŸ”„ é‡å®šå‘åˆ°ç™»å…¥é é¢...');
                        window.location.href = '/login';
                    }, 3000);
                    
                    return false;
                }
                
                console.log('âœ… èªè­‰æˆåŠŸ: ç”¨æˆ¶å·²ç™»å…¥');
                return true;
            }
            
            // é¡¯ç¤ºèªè­‰å¤±æ•—è­¦å‘Š
            function showAuthenticationAlert() {
                // å‰µå»ºè­¦å‘Šå½ˆçª—
                const alertDiv = document.createElement('div');
                alertDiv.id = 'auth-alert';
                alertDiv.innerHTML = `
                    <div style="
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0,0,0,0.8);
                        z-index: 9999;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-family: Arial, sans-serif;
                    ">
                        <div style="
                            background: white;
                            padding: 30px;
                            border-radius: 10px;
                            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                            text-align: center;
                            max-width: 400px;
                        ">
                            <h2 style="color: #d32f2f; margin-bottom: 20px;">
                                ğŸ” éœ€è¦ç™»å…¥é©—è­‰
                            </h2>
                            <p style="color: #666; margin-bottom: 20px;">
                                æ‚¨éœ€è¦å…ˆç™»å…¥æ‰èƒ½è¨ªå•å“¡å·¥å·¥ä½œå°
                            </p>
                            <p style="color: #999; font-size: 14px;">
                                3ç§’å¾Œå°‡è‡ªå‹•è·³è½‰åˆ°ç™»å…¥é é¢...
                            </p>
                            <div style="margin-top: 20px;">
                                <button onclick="window.location.href='/login'" style="
                                    background: #1976d2;
                                    color: white;
                                    border: none;
                                    padding: 10px 20px;
                                    border-radius: 5px;
                                    cursor: pointer;
                                    font-size: 16px;
                                ">
                                    ç«‹å³ç™»å…¥
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(alertDiv);
            }
            
            // éš±è—é é¢å…§å®¹ç›´åˆ°èªè­‰å®Œæˆ
            function hidePageContent() {
                document.body.style.visibility = 'hidden';
                document.body.style.opacity = '0';
            }
            
            // é¡¯ç¤ºé é¢å…§å®¹
            function showPageContent() {
                document.body.style.visibility = 'visible';
                document.body.style.opacity = '1';
                document.body.style.transition = 'opacity 0.3s ease';
            }
            
            // DOMè¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œèªè­‰æª¢æŸ¥ (æ·»åŠ å°å»¶é²ç¢ºä¿localStorageåŒæ­¥)
            function delayedAuthCheck() {
                hidePageContent();
                
                // å»¶é²500msç¢ºä¿localStorageå®Œå…¨åŒæ­¥
                setTimeout(() => {
                    if (checkAuthentication()) {
                        showPageContent();
                    }
                }, 500);
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', delayedAuthCheck);
            } else {
                delayedAuthCheck();
            }
            
            // å®šæœŸæª¢æŸ¥èªè­‰ç‹€æ…‹ (æ¯30ç§’)
            setInterval(function() {
                const token = localStorage.getItem('employeeToken') || sessionStorage.getItem('employeeToken');
                if (!token) {
                    console.log('âš ï¸ èªè­‰tokenå·²å¤±æ•ˆï¼Œé‡å®šå‘åˆ°ç™»å…¥é é¢...');
                    window.location.href = '/login';
                }
            }, 30000);
            
            console.log('âœ… å“¡å·¥é é¢èªè­‰æª¢æŸ¥ç³»çµ±å·²å•Ÿå‹•');
        })();
        </script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="index.html">å“¡å·¥ç®¡ç†ç³»çµ±</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="profile.html">å€‹äººè³‡æ–™</a>
                <a class="nav-link" href="attendance.html">è€ƒå‹¤æ‰“å¡</a>
                <a class="nav-link" href="#" onclick="logout()">ç™»å‡º</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-12">
                <h2>å“¡å·¥å·¥ä½œå°</h2>
                <div class="row mt-4">
                    <div class="col-md-6 col-lg-3 mb-4">
                        <div class="card bg-primary text-white">
                            <div class="card-body">
                                <h5 class="card-title">ä»Šæ—¥è€ƒå‹¤</h5>
                                <p class="card-text">é»æ“Šé€²è¡Œæ‰“å¡</p>
                                <a href="attendance.html" class="btn btn-light">å‰å¾€æ‰“å¡</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3 mb-4">
                        <div class="card bg-success text-white">
                            <div class="card-body">
                                <h5 class="card-title">ç‡Ÿæ”¶è¨˜éŒ„</h5>
                                <p class="card-text">æŸ¥çœ‹ç‡Ÿæ”¶çµ±è¨ˆ</p>
                                <a href="revenue.html" class="btn btn-light">æŸ¥çœ‹è¨˜éŒ„</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3 mb-4">
                        <div class="card bg-info text-white">
                            <div class="card-body">
                                <h5 class="card-title">å€‹äººè³‡æ–™</h5>
                                <p class="card-text">ç®¡ç†å€‹äººä¿¡æ¯</p>
                                <a href="profile.html" class="btn btn-light">ç·¨è¼¯è³‡æ–™</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3 mb-4">
                        <div class="card bg-warning text-white">
                            <div class="card-body">
                                <h5 class="card-title">ç‡Ÿæ”¶å ±è¡¨</h5>
                                <p class="card-text">æŸ¥çœ‹ç‡Ÿæ”¶çµ±è¨ˆå ±è¡¨è³‡æ–™</p>
                                <a href="revenue.html" class="btn btn-light">æŸ¥çœ‹å ±è¡¨</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5>è¿‘æœŸè€ƒå‹¤è¨˜éŒ„</h5>
                    </div>
                    <div class="card-body">
                        <div id="attendanceRecords">
                            <p class="text-muted">è¼‰å…¥ä¸­...</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5>å¿«é€Ÿæ“ä½œ</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary w-100 mb-2" onclick="quickClockIn()">å¿«é€Ÿæ‰“å¡</button>
                        <button class="btn btn-success w-100 mb-2" onclick="addRevenue()">æ–°å¢ç‡Ÿæ”¶</button>
                        <button class="btn btn-info w-100" onclick="viewProfile()">æŸ¥çœ‹è³‡æ–™</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/app.js"></script>
</body>
</html>