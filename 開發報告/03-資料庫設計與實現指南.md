# ğŸ’¾ ä¼æ¥­å“¡å·¥ç®¡ç†ç³»çµ± - è³‡æ–™åº«è¨­è¨ˆèˆ‡å¯¦ç¾æŒ‡å—

## ğŸ“‹ æ–‡æª”æ¦‚è¿°

æœ¬æŒ‡å—æä¾›å®Œæ•´çš„è³‡æ–™åº«è¨­è¨ˆæ–¹æ¡ˆï¼ŒåŒ…å«ï¼š
- è³‡æ–™è¡¨çµæ§‹å®šç¾©
- é—œè¯é—œä¿‚è¨­è¨ˆ
- ç´¢å¼•å„ªåŒ–ç­–ç•¥
- è³‡æ–™é·ç§»æ–¹æ¡ˆ
- æ•ˆèƒ½èª¿å„ªå»ºè­°

---

## ğŸ—ï¸ è³‡æ–™åº«æ¶æ§‹ç¸½è¦½

### æŠ€è¡“é¸å‹å°æ¯”

| æ–¹æ¡ˆ | å„ªé» | ç¼ºé» | é©ç”¨å ´æ™¯ |
|------|------|------|----------|
| **è¨˜æ†¶é«”æ¨¡æ“¬** | é–‹ç™¼å¿«é€Ÿã€ç„¡éœ€è¨­ç½® | è³‡æ–™ä¸æŒä¹…ã€å®¹é‡é™åˆ¶ | é–‹ç™¼æ¸¬è©¦ |
| **Google Sheets** | å…è²»ã€æ˜“ç¶­è­·ã€è‡ªå‹•å‚™ä»½ | æŸ¥è©¢æ•ˆèƒ½ä½ã€ä¸¦ç™¼é™åˆ¶ | å°å‹ä¼æ¥­ |
| **PostgreSQL** | é«˜æ•ˆèƒ½ã€ACIDã€æ“´å±•æ€§å¼· | éœ€è¦ç¶­è­·ã€æˆæœ¬è¼ƒé«˜ | ä¸­å¤§å‹ä¼æ¥­ |
| **MongoDB** | éˆæ´»schemaã€æ°´å¹³æ“´å±• | äº‹å‹™æ”¯æ´å¼±ã€ä¸€è‡´æ€§ | å¤§æ•¸æ“šå ´æ™¯ |

### æ¨è–¦æ¶æ§‹
```
é–‹ç™¼ç’°å¢ƒï¼šè¨˜æ†¶é«”æ¨¡æ“¬
æ¸¬è©¦ç’°å¢ƒï¼šSQLite
ç”Ÿç”¢ç’°å¢ƒï¼šPostgreSQL + Rediså¿«å–
```

---

## ğŸ“Š æ ¸å¿ƒè³‡æ–™è¡¨è¨­è¨ˆ

### 1. å“¡å·¥è³‡æ–™è¡¨ (employees)

```sql
CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    employee_code VARCHAR(20) UNIQUE NOT NULL,
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    
    -- åŸºæœ¬è³‡æ–™
    name VARCHAR(100) NOT NULL,
    id_number VARCHAR(20) UNIQUE NOT NULL,
    birth_date DATE NOT NULL,
    gender VARCHAR(10) CHECK (gender IN ('ç”·', 'å¥³', 'å…¶ä»–')),
    
    -- è¯çµ¡è³‡è¨Š
    phone VARCHAR(20) NOT NULL,
    email VARCHAR(100),
    address TEXT,
    line_id VARCHAR(50),
    
    -- ç·Šæ€¥è¯çµ¡äºº
    emergency_contact VARCHAR(100),
    emergency_phone VARCHAR(20),
    emergency_relationship VARCHAR(50),
    
    -- å·¥ä½œè³‡è¨Š
    department VARCHAR(50) NOT NULL,
    position VARCHAR(50) NOT NULL,
    role VARCHAR(20) NOT NULL CHECK (role IN ('employee', 'manager', 'admin')),
    store_name VARCHAR(50) NOT NULL,
    hire_date DATE NOT NULL,
    
    -- è–ªè³‡è³‡è¨Š
    base_salary DECIMAL(10, 2),
    
    -- ç³»çµ±è³‡è¨Š
    status VARCHAR(20) DEFAULT 'active' CHECK (status IN ('active', 'inactive', 'suspended')),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_login_at TIMESTAMP,
    
    -- çµ±è¨ˆè³‡è¨Š
    total_work_days INTEGER DEFAULT 0,
    current_position_days INTEGER DEFAULT 0,
    
    -- é§•ç…§è³‡è¨Š
    license_type VARCHAR(50),
    
    -- ç´¢å¼•
    INDEX idx_employee_code (employee_code),
    INDEX idx_username (username),
    INDEX idx_department_store (department, store_name),
    INDEX idx_status (status)
);

-- è§¸ç™¼å™¨ï¼šè‡ªå‹•æ›´æ–° updated_at
CREATE TRIGGER update_employees_updated_at 
    BEFORE UPDATE ON employees 
    FOR EACH ROW 
    SET NEW.updated_at = CURRENT_TIMESTAMP;
```

### 2. è€ƒå‹¤è¨˜éŒ„è¡¨ (attendance_records)

```sql
CREATE TABLE attendance_records (
    id SERIAL PRIMARY KEY,
    employee_id INTEGER NOT NULL,
    
    -- æ‰“å¡è³‡è¨Š
    clock_type VARCHAR(10) NOT NULL CHECK (clock_type IN ('ä¸Šç­', 'ä¸‹ç­')),
    clock_time TIMESTAMP NOT NULL,
    store_name VARCHAR(50) NOT NULL,
    
    -- GPSè³‡è¨Š
    gps_latitude DECIMAL(10, 8),
    gps_longitude DECIMAL(11, 8),
    gps_accuracy DECIMAL(6, 2),
    distance_meters DECIMAL(8, 2),
    
    -- è¨­å‚™è³‡è¨Š
    device_fingerprint VARCHAR(255),
    ip_address VARCHAR(45),
    user_agent TEXT,
    
    -- ç‹€æ…‹è³‡è¨Š
    status VARCHAR(20) DEFAULT 'æ­£å¸¸' CHECK (status IN ('æ­£å¸¸', 'é²åˆ°', 'æ—©é€€', 'ç•°å¸¸')),
    late_minutes INTEGER DEFAULT 0,
    anomaly_reason TEXT,
    
    -- æ™‚é–“æˆ³è¨˜
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- å¤–éµç´„æŸ
    FOREIGN KEY (employee_id) REFERENCES employees(id) ON DELETE CASCADE,
    
    -- ç´¢å¼•
    INDEX idx_employee_date (employee_id, clock_time),
    INDEX idx_clock_type (clock_type),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at)
);

-- è¤‡åˆå”¯ä¸€ç´¢å¼•ï¼šé˜²æ­¢é‡è¤‡æ‰“å¡
CREATE UNIQUE INDEX idx_unique_clock 
    ON attendance_records(employee_id, DATE(clock_time), clock_type);
```

### 3. ç‡Ÿæ”¶è¨˜éŒ„è¡¨ (revenue_records)

```sql
CREATE TABLE revenue_records (
    id SERIAL PRIMARY KEY,
    employee_id INTEGER NOT NULL,
    
    -- ç‡Ÿæ”¶è³‡è¨Š
    revenue_date DATE NOT NULL,
    store_name VARCHAR(50) NOT NULL,
    
    -- æ”¶å…¥æ˜ç´° (JSONæ ¼å¼)
    revenue_details JSON NOT NULL DEFAULT '{}',
    /* æ ¼å¼ç¯„ä¾‹ï¼š
    {
        "ç¾å ´": 35000,
        "å¤–é€": 15000,
        "å¤–å¸¶": 8000,
        "å…¶ä»–": 2000
    }
    */
    
    -- æ”¯å‡ºæ˜ç´° (JSONæ ¼å¼)
    expense_details JSON NOT NULL DEFAULT '{}',
    /* æ ¼å¼ç¯„ä¾‹ï¼š
    {
        "é£Ÿæ": 18000,
        "äººäº‹": 12000,
        "æ°´é›»": 3000,
        "å…¶ä»–": 2000
    }
    */
    
    -- è¨ˆç®—æ¬„ä½
    total_revenue DECIMAL(12, 2) GENERATED ALWAYS AS (
        CAST(revenue_details->>'ç¾å ´' AS DECIMAL) +
        CAST(revenue_details->>'å¤–é€' AS DECIMAL) +
        CAST(revenue_details->>'å¤–å¸¶' AS DECIMAL) +
        CAST(revenue_details->>'å…¶ä»–' AS DECIMAL)
    ) STORED,
    
    total_expense DECIMAL(12, 2) GENERATED ALWAYS AS (
        CAST(expense_details->>'é£Ÿæ' AS DECIMAL) +
        CAST(expense_details->>'äººäº‹' AS DECIMAL) +
        CAST(expense_details->>'æ°´é›»' AS DECIMAL) +
        CAST(expense_details->>'å…¶ä»–' AS DECIMAL)
    ) STORED,
    
    net_revenue DECIMAL(12, 2) GENERATED ALWAYS AS (
        total_revenue - total_expense
    ) STORED,
    
    -- çé‡‘è³‡è¨Š
    bonus_rate DECIMAL(5, 2),
    bonus_amount DECIMAL(10, 2),
    is_target_achieved BOOLEAN DEFAULT FALSE,
    
    -- ç…§ç‰‡è­‰æ˜
    photo_urls JSON,
    
    -- ç‹€æ…‹è³‡è¨Š
    status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'approved', 'rejected')),
    approved_by INTEGER,
    approved_at TIMESTAMP,
    
    -- å‚™è¨»
    notes TEXT,
    
    -- æ™‚é–“æˆ³è¨˜
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- å¤–éµç´„æŸ
    FOREIGN KEY (employee_id) REFERENCES employees(id) ON DELETE CASCADE,
    FOREIGN KEY (approved_by) REFERENCES employees(id),
    
    -- ç´¢å¼•
    INDEX idx_revenue_date (revenue_date),
    INDEX idx_employee_month (employee_id, DATE_TRUNC('month', revenue_date)),
    INDEX idx_store_date (store_name, revenue_date),
    UNIQUE INDEX idx_unique_daily_revenue (employee_id, revenue_date, store_name)
);
```

### 4. åº«å­˜ç®¡ç†è¡¨ (inventory_items)

```sql
CREATE TABLE inventory_items (
    id SERIAL PRIMARY KEY,
    
    -- å“é …è³‡è¨Š
    item_code VARCHAR(50) UNIQUE NOT NULL,
    item_name VARCHAR(100) NOT NULL,
    category VARCHAR(50) NOT NULL,
    unit VARCHAR(20) NOT NULL,
    
    -- åº«å­˜è³‡è¨Š
    current_quantity DECIMAL(10, 2) NOT NULL DEFAULT 0,
    min_quantity DECIMAL(10, 2) NOT NULL DEFAULT 0,
    max_quantity DECIMAL(10, 2),
    
    -- åƒ¹æ ¼è³‡è¨Š
    unit_price DECIMAL(10, 2),
    last_purchase_price DECIMAL(10, 2),
    average_price DECIMAL(10, 2),
    
    -- ä¾›æ‡‰å•†è³‡è¨Š
    primary_supplier VARCHAR(100),
    supplier_contact VARCHAR(100),
    
    -- ç‹€æ…‹è³‡è¨Š
    is_active BOOLEAN DEFAULT TRUE,
    last_order_date DATE,
    last_receive_date DATE,
    
    -- æ™‚é–“æˆ³è¨˜
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- ç´¢å¼•
    INDEX idx_item_name (item_name),
    INDEX idx_category (category),
    INDEX idx_active (is_active)
);
```

### 5. å«è²¨è¨˜éŒ„è¡¨ (order_records)

```sql
CREATE TABLE order_records (
    id SERIAL PRIMARY KEY,
    order_number VARCHAR(50) UNIQUE NOT NULL,
    employee_id INTEGER NOT NULL,
    
    -- è¨‚å–®è³‡è¨Š
    order_date DATE NOT NULL,
    store_name VARCHAR(50) NOT NULL,
    supplier VARCHAR(100) NOT NULL,
    
    -- è¨‚å–®æ˜ç´° (JSONæ ¼å¼)
    order_items JSON NOT NULL,
    /* æ ¼å¼ç¯„ä¾‹ï¼š
    [
        {
            "item_id": 1,
            "item_name": "é›èƒ¸è‚‰",
            "quantity": 50,
            "unit": "å…¬æ–¤",
            "unit_price": 120,
            "subtotal": 6000
        }
    ]
    */
    
    -- é‡‘é¡è³‡è¨Š
    total_amount DECIMAL(12, 2) NOT NULL,
    
    -- äº¤è²¨è³‡è¨Š
    expected_delivery DATE,
    actual_delivery DATE,
    received_by INTEGER,
    
    -- ç‹€æ…‹è³‡è¨Š
    status VARCHAR(20) DEFAULT 'pending' CHECK (
        status IN ('pending', 'confirmed', 'shipped', 'received', 'cancelled')
    ),
    
    -- ç•°å¸¸è™•ç†
    has_anomaly BOOLEAN DEFAULT FALSE,
    anomaly_type VARCHAR(50),
    anomaly_description TEXT,
    
    -- ç…§ç‰‡è­‰æ˜
    order_photo_url TEXT,
    receipt_photo_url TEXT,
    
    -- å‚™è¨»
    notes TEXT,
    
    -- æ™‚é–“æˆ³è¨˜
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- å¤–éµç´„æŸ
    FOREIGN KEY (employee_id) REFERENCES employees(id),
    FOREIGN KEY (received_by) REFERENCES employees(id),
    
    -- ç´¢å¼•
    INDEX idx_order_date (order_date),
    INDEX idx_status (status),
    INDEX idx_supplier (supplier),
    INDEX idx_store_date (store_name, order_date)
);
```

### 6. æ’ç­è¨˜éŒ„è¡¨ (schedule_records)

```sql
-- å“¡å·¥æ’ç­ç”³è«‹è¡¨
CREATE TABLE schedule_requests (
    id SERIAL PRIMARY KEY,
    employee_id INTEGER NOT NULL,
    
    -- æ’ç­è³‡è¨Š
    schedule_month DATE NOT NULL,
    store_name VARCHAR(50) NOT NULL,
    
    -- åå¥½è¨­å®š (JSONæ ¼å¼)
    preferences JSON NOT NULL,
    /* æ ¼å¼ç¯„ä¾‹ï¼š
    {
        "preferred_dates": ["2025-01-05", "2025-01-12"],
        "preferred_shifts": ["morning", "evening"],
        "avoid_dates": ["2025-01-20"],
        "max_hours_per_week": 40
    }
    */
    
    -- ç‹€æ…‹è³‡è¨Š
    status VARCHAR(20) DEFAULT 'pending' CHECK (
        status IN ('pending', 'processed', 'cancelled')
    ),
    
    -- æ™‚é–“æˆ³è¨˜
    submitted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    processed_at TIMESTAMP,
    
    -- å¤–éµç´„æŸ
    FOREIGN KEY (employee_id) REFERENCES employees(id),
    
    -- ç´¢å¼•
    INDEX idx_employee_month (employee_id, schedule_month),
    UNIQUE INDEX idx_unique_request (employee_id, schedule_month)
);

-- æ­£å¼æ’ç­è¡¨
CREATE TABLE schedules (
    id SERIAL PRIMARY KEY,
    employee_id INTEGER NOT NULL,
    
    -- æ’ç­è³‡è¨Š
    schedule_date DATE NOT NULL,
    store_name VARCHAR(50) NOT NULL,
    shift_type VARCHAR(20) NOT NULL CHECK (
        shift_type IN ('morning', 'afternoon', 'evening', 'night')
    ),
    
    -- æ™‚é–“è³‡è¨Š
    start_time TIME NOT NULL,
    end_time TIME NOT NULL,
    break_minutes INTEGER DEFAULT 60,
    
    -- ç‹€æ…‹è³‡è¨Š
    is_holiday BOOLEAN DEFAULT FALSE,
    holiday_type VARCHAR(50),
    is_confirmed BOOLEAN DEFAULT FALSE,
    
    -- èª¿ç­è³‡è¨Š
    original_employee_id INTEGER,
    swap_reason TEXT,
    
    -- ç®¡ç†è³‡è¨Š
    created_by INTEGER NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- å¤–éµç´„æŸ
    FOREIGN KEY (employee_id) REFERENCES employees(id),
    FOREIGN KEY (original_employee_id) REFERENCES employees(id),
    FOREIGN KEY (created_by) REFERENCES employees(id),
    
    -- ç´¢å¼•
    INDEX idx_employee_date (employee_id, schedule_date),
    INDEX idx_store_date (store_name, schedule_date),
    UNIQUE INDEX idx_unique_schedule (employee_id, schedule_date, shift_type)
);
```

### 7. å‡é·æŠ•ç¥¨è¡¨ (promotion_votes)

```sql
-- å‡é·ç”³è«‹ä¸»è¡¨
CREATE TABLE promotion_applications (
    id SERIAL PRIMARY KEY,
    candidate_id INTEGER NOT NULL,
    
    -- å‡é·è³‡è¨Š
    current_position VARCHAR(50) NOT NULL,
    target_position VARCHAR(50) NOT NULL,
    
    -- ç”³è«‹è³‡è¨Š
    application_reason TEXT NOT NULL,
    achievements TEXT,
    
    -- æŠ•ç¥¨è¨­å®š
    voting_start_date TIMESTAMP NOT NULL,
    voting_end_date TIMESTAMP NOT NULL,
    required_approve_votes INTEGER NOT NULL,
    
    -- æŠ•ç¥¨çµ±è¨ˆ
    total_approve_votes INTEGER DEFAULT 0,
    total_reject_votes INTEGER DEFAULT 0,
    total_abstain_votes INTEGER DEFAULT 0,
    
    -- ç‹€æ…‹è³‡è¨Š
    status VARCHAR(20) DEFAULT 'voting' CHECK (
        status IN ('voting', 'approved', 'rejected', 'cancelled')
    ),
    
    -- çµæœè³‡è¨Š
    final_result VARCHAR(20),
    result_date TIMESTAMP,
    result_notes TEXT,
    
    -- ç®¡ç†è³‡è¨Š
    initiated_by INTEGER NOT NULL,
    approved_by INTEGER,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- å¤–éµç´„æŸ
    FOREIGN KEY (candidate_id) REFERENCES employees(id),
    FOREIGN KEY (initiated_by) REFERENCES employees(id),
    FOREIGN KEY (approved_by) REFERENCES employees(id),
    
    -- ç´¢å¼•
    INDEX idx_candidate (candidate_id),
    INDEX idx_status (status),
    INDEX idx_voting_period (voting_start_date, voting_end_date)
);

-- æŠ•ç¥¨è¨˜éŒ„è¡¨
CREATE TABLE promotion_vote_records (
    id SERIAL PRIMARY KEY,
    application_id INTEGER NOT NULL,
    
    -- æŠ•ç¥¨è³‡è¨Šï¼ˆåŒ¿åï¼‰
    anonymous_voter_id VARCHAR(255) NOT NULL, -- åŠ å¯†çš„æŠ•ç¥¨è€…ID
    vote_decision VARCHAR(20) NOT NULL CHECK (
        vote_decision IN ('approve', 'reject', 'abstain')
    ),
    vote_comment TEXT,
    
    -- é˜²ä½œå¼Šè³‡è¨Š
    ip_address_hash VARCHAR(255),
    device_fingerprint_hash VARCHAR(255),
    
    -- æ™‚é–“æˆ³è¨˜
    voted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- å¤–éµç´„æŸ
    FOREIGN KEY (application_id) REFERENCES promotion_applications(id),
    
    -- ç´¢å¼•
    INDEX idx_application (application_id),
    UNIQUE INDEX idx_unique_vote (application_id, anonymous_voter_id)
);
```

### 8. ç¶­ä¿®è¨˜éŒ„è¡¨ (maintenance_records)

```sql
CREATE TABLE maintenance_records (
    id SERIAL PRIMARY KEY,
    ticket_number VARCHAR(50) UNIQUE NOT NULL,
    reported_by INTEGER NOT NULL,
    
    -- å ±ä¿®è³‡è¨Š
    report_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    store_name VARCHAR(50) NOT NULL,
    equipment_type VARCHAR(50) NOT NULL,
    equipment_name VARCHAR(100) NOT NULL,
    
    -- å•é¡Œæè¿°
    issue_description TEXT NOT NULL,
    priority VARCHAR(20) NOT NULL CHECK (
        priority IN ('low', 'medium', 'high', 'urgent')
    ),
    
    -- ç…§ç‰‡è­‰æ˜
    issue_photos JSON,
    
    -- è™•ç†è³‡è¨Š
    status VARCHAR(20) DEFAULT 'reported' CHECK (
        status IN ('reported', 'assigned', 'in_progress', 'completed', 'verified')
    ),
    assigned_to VARCHAR(100),
    assigned_at TIMESTAMP,
    
    -- ç¶­ä¿®è³‡è¨Š
    repair_start_time TIMESTAMP,
    repair_end_time TIMESTAMP,
    repair_description TEXT,
    parts_replaced TEXT,
    
    -- æˆæœ¬è³‡è¨Š
    labor_cost DECIMAL(10, 2),
    parts_cost DECIMAL(10, 2),
    total_cost DECIMAL(10, 2) GENERATED ALWAYS AS (
        COALESCE(labor_cost, 0) + COALESCE(parts_cost, 0)
    ) STORED,
    
    -- é©—æ”¶è³‡è¨Š
    verified_by INTEGER,
    verified_at TIMESTAMP,
    verification_notes TEXT,
    
    -- æ™‚é–“æˆ³è¨˜
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- å¤–éµç´„æŸ
    FOREIGN KEY (reported_by) REFERENCES employees(id),
    FOREIGN KEY (verified_by) REFERENCES employees(id),
    
    -- ç´¢å¼•
    INDEX idx_status (status),
    INDEX idx_priority (priority),
    INDEX idx_store_equipment (store_name, equipment_type),
    INDEX idx_report_date (report_date)
);
```

### 9. å…¬å‘Šç³»çµ±è¡¨ (announcements)

```sql
CREATE TABLE announcements (
    id SERIAL PRIMARY KEY,
    
    -- å…¬å‘Šè³‡è¨Š
    title VARCHAR(200) NOT NULL,
    content TEXT NOT NULL,
    type VARCHAR(50) NOT NULL CHECK (
        type IN ('notice', 'policy', 'event', 'emergency', 'other')
    ),
    priority VARCHAR(20) NOT NULL CHECK (
        priority IN ('low', 'normal', 'high', 'urgent')
    ),
    
    -- ç™¼å¸ƒè³‡è¨Š
    author_id INTEGER NOT NULL,
    publish_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    expire_date TIMESTAMP,
    
    -- ç›®æ¨™å°è±¡
    target_departments JSON, -- ["ITéƒ¨é–€", "ç®¡ç†éƒ¨é–€"]
    target_stores JSON,      -- ["å…§å£¢åº—", "æ¡ƒåœ’åº—"]
    target_roles JSON,       -- ["employee", "manager"]
    
    -- ç‹€æ…‹è³‡è¨Š
    is_active BOOLEAN DEFAULT TRUE,
    is_pinned BOOLEAN DEFAULT FALSE,
    
    -- çµ±è¨ˆè³‡è¨Š
    view_count INTEGER DEFAULT 0,
    
    -- é™„ä»¶
    attachments JSON,
    
    -- æ™‚é–“æˆ³è¨˜
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- å¤–éµç´„æŸ
    FOREIGN KEY (author_id) REFERENCES employees(id),
    
    -- ç´¢å¼•
    INDEX idx_active_pinned (is_active, is_pinned),
    INDEX idx_publish_expire (publish_date, expire_date),
    INDEX idx_type_priority (type, priority)
);

-- å…¬å‘Šå·²è®€è¨˜éŒ„è¡¨
CREATE TABLE announcement_reads (
    id SERIAL PRIMARY KEY,
    announcement_id INTEGER NOT NULL,
    employee_id INTEGER NOT NULL,
    read_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- å¤–éµç´„æŸ
    FOREIGN KEY (announcement_id) REFERENCES announcements(id) ON DELETE CASCADE,
    FOREIGN KEY (employee_id) REFERENCES employees(id) ON DELETE CASCADE,
    
    -- ç´¢å¼•
    UNIQUE INDEX idx_unique_read (announcement_id, employee_id)
);
```

### 10. ç³»çµ±è¨­å®šè¡¨ (system_settings)

```sql
CREATE TABLE system_settings (
    id SERIAL PRIMARY KEY,
    
    -- è¨­å®šè³‡è¨Š
    category VARCHAR(50) NOT NULL,
    setting_key VARCHAR(100) NOT NULL,
    setting_value TEXT NOT NULL,
    value_type VARCHAR(20) NOT NULL CHECK (
        value_type IN ('string', 'number', 'boolean', 'json', 'date')
    ),
    
    -- èªªæ˜è³‡è¨Š
    description TEXT,
    default_value TEXT,
    
    -- é©—è­‰è¦å‰‡
    validation_rules JSON,
    
    -- ç®¡ç†è³‡è¨Š
    is_editable BOOLEAN DEFAULT TRUE,
    last_modified_by INTEGER,
    last_modified_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- å¤–éµç´„æŸ
    FOREIGN KEY (last_modified_by) REFERENCES employees(id),
    
    -- ç´¢å¼•
    UNIQUE INDEX idx_unique_setting (category, setting_key),
    INDEX idx_category (category)
);

-- é è¨­ç³»çµ±è¨­å®š
INSERT INTO system_settings (category, setting_key, setting_value, value_type, description) VALUES
('attendance', 'gps_radius', '100', 'number', 'GPSæ‰“å¡å…è¨±åŠå¾‘ï¼ˆå…¬å°ºï¼‰'),
('attendance', 'late_grace_minutes', '10', 'number', 'é²åˆ°å¯¬é™æ™‚é–“ï¼ˆåˆ†é˜ï¼‰'),
('revenue', 'bonus_thresholds', '[{"rate": 1.0, "bonus": 0.01}, {"rate": 1.1, "bonus": 0.02}]', 'json', 'çé‡‘é–€æª»è¨­å®š'),
('maintenance', 'urgent_priority_hours', '4', 'number', 'ç·Šæ€¥ç¶­ä¿®å›æ‡‰æ™‚é–“ï¼ˆå°æ™‚ï¼‰'),
('notification', 'telegram_boss_group', '-1002658082392', 'string', 'è€é—†Telegramç¾¤çµ„ID'),
('notification', 'telegram_employee_group', '-1002658082393', 'string', 'å“¡å·¥Telegramç¾¤çµ„ID');
```

### 11. æ“ä½œæ—¥èªŒè¡¨ (audit_logs)

```sql
CREATE TABLE audit_logs (
    id SERIAL PRIMARY KEY,
    
    -- æ“ä½œè³‡è¨Š
    user_id INTEGER,
    action_type VARCHAR(50) NOT NULL,
    table_name VARCHAR(50),
    record_id INTEGER,
    
    -- è®Šæ›´è³‡è¨Š
    old_values JSON,
    new_values JSON,
    
    -- è«‹æ±‚è³‡è¨Š
    ip_address VARCHAR(45),
    user_agent TEXT,
    request_method VARCHAR(10),
    request_url TEXT,
    
    -- çµæœè³‡è¨Š
    is_success BOOLEAN DEFAULT TRUE,
    error_message TEXT,
    
    -- æ™‚é–“æˆ³è¨˜
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- å¤–éµç´„æŸï¼ˆå…è¨±NULLä»¥è¨˜éŒ„ç³»çµ±æ“ä½œï¼‰
    FOREIGN KEY (user_id) REFERENCES employees(id) ON DELETE SET NULL,
    
    -- ç´¢å¼•
    INDEX idx_user_action (user_id, action_type),
    INDEX idx_table_record (table_name, record_id),
    INDEX idx_created_at (created_at)
);
```

---

## ğŸ”— è³‡æ–™è¡¨é—œè¯é—œä¿‚

### ERåœ–èªªæ˜
```
employees (1) â”€â”€â”€â”€â”€â”€< (N) attendance_records
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€< (N) revenue_records
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€< (N) order_records
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€< (N) schedule_requests
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€< (N) schedules
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€< (N) promotion_applications (as candidate)
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€< (N) promotion_applications (as initiator)
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€< (N) maintenance_records (as reporter)
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€< (N) announcements (as author)
    â”‚
    â””â”€â”€â”€â”€â”€â”€< (N) audit_logs

promotion_applications (1) â”€â”€â”€â”€â”€â”€< (N) promotion_vote_records

announcements (1) â”€â”€â”€â”€â”€â”€< (N) announcement_reads

inventory_items â†â”€â”€â”€â”€ order_records (through JSON)
```

---

## ğŸš€ æ•ˆèƒ½å„ªåŒ–ç­–ç•¥

### 1. ç´¢å¼•è¨­è¨ˆåŸå‰‡

```sql
-- è¤‡åˆç´¢å¼•ç¯„ä¾‹
CREATE INDEX idx_attendance_employee_month 
    ON attendance_records(employee_id, DATE_TRUNC('month', clock_time));

-- éƒ¨åˆ†ç´¢å¼•ç¯„ä¾‹ï¼ˆåªç´¢å¼•æ´»èºå“¡å·¥ï¼‰
CREATE INDEX idx_active_employees 
    ON employees(username) 
    WHERE status = 'active';

-- å‡½æ•¸ç´¢å¼•ç¯„ä¾‹
CREATE INDEX idx_revenue_month 
    ON revenue_records(DATE_TRUNC('month', revenue_date));
```

### 2. æŸ¥è©¢å„ªåŒ–å»ºè­°

```sql
-- ä½¿ç”¨ WITH å­å¥æé«˜å¯è®€æ€§å’Œæ•ˆèƒ½
WITH monthly_revenue AS (
    SELECT 
        employee_id,
        DATE_TRUNC('month', revenue_date) as month,
        SUM(net_revenue) as total_revenue
    FROM revenue_records
    WHERE status = 'approved'
    GROUP BY employee_id, DATE_TRUNC('month', revenue_date)
)
SELECT 
    e.name,
    mr.month,
    mr.total_revenue,
    RANK() OVER (PARTITION BY mr.month ORDER BY mr.total_revenue DESC) as rank
FROM monthly_revenue mr
JOIN employees e ON e.id = mr.employee_id
WHERE mr.month = DATE_TRUNC('month', CURRENT_DATE);
```

### 3. åˆ†å€ç­–ç•¥

```sql
-- æŒ‰æœˆåˆ†å€è€ƒå‹¤è¨˜éŒ„è¡¨
CREATE TABLE attendance_records_2025_01 PARTITION OF attendance_records
    FOR VALUES FROM ('2025-01-01') TO ('2025-02-01');

CREATE TABLE attendance_records_2025_02 PARTITION OF attendance_records
    FOR VALUES FROM ('2025-02-01') TO ('2025-03-01');
```

---

## ğŸ”„ è³‡æ–™é·ç§»æ–¹æ¡ˆ

### å¾è¨˜æ†¶é«”åˆ°PostgreSQL

```javascript
// é·ç§»è…³æœ¬ç¯„ä¾‹
async function migrateToPostgreSQL() {
    const memoryData = getCurrentMemoryData();
    
    // 1. å»ºç«‹é€£æ¥
    const pg = new Pool({
        connectionString: process.env.DATABASE_URL
    });
    
    // 2. é–‹å§‹äº‹å‹™
    const client = await pg.connect();
    try {
        await client.query('BEGIN');
        
        // 3. é·ç§»å“¡å·¥è³‡æ–™
        for (const employee of memoryData.employees) {
            await client.query(`
                INSERT INTO employees (
                    username, password_hash, name, id_number,
                    department, position, role, store_name, hire_date
                ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)
            `, [
                employee.username,
                await bcrypt.hash(employee.password, 10),
                employee.name,
                employee.idNumber,
                employee.department,
                employee.position,
                employee.role,
                employee.storeName,
                employee.hireDate
            ]);
        }
        
        // 4. é·ç§»å…¶ä»–è³‡æ–™è¡¨...
        
        await client.query('COMMIT');
    } catch (error) {
        await client.query('ROLLBACK');
        throw error;
    } finally {
        client.release();
    }
}
```

### å¾Google Sheetsåˆ°PostgreSQL

```javascript
// Google Sheets é·ç§»è…³æœ¬
async function migrateFromGoogleSheets() {
    const sheets = google.sheets({ version: 'v4', auth });
    
    // 1. è®€å–å“¡å·¥è³‡æ–™
    const employeesResponse = await sheets.spreadsheets.values.get({
        spreadsheetId: SPREADSHEET_ID,
        range: 'Employees!A2:U'
    });
    
    const employees = employeesResponse.data.values;
    
    // 2. è½‰æ›ä¸¦æ’å…¥
    for (const row of employees) {
        const employee = {
            employee_code: row[0],
            name: row[1],
            id_number: row[2],
            birth_date: row[3],
            gender: row[4],
            // ... å…¶ä»–æ¬„ä½æ˜ å°„
        };
        
        await insertEmployee(employee);
    }
}
```

---

## ğŸ“Š ç›£æ§èˆ‡ç¶­è­·

### 1. æ•ˆèƒ½ç›£æ§æŸ¥è©¢

```sql
-- æŸ¥è©¢æ…¢æŸ¥è©¢
SELECT 
    query,
    mean_exec_time,
    calls,
    total_exec_time
FROM pg_stat_statements
WHERE mean_exec_time > 100
ORDER BY mean_exec_time DESC
LIMIT 20;

-- æŸ¥è©¢è¡¨å¤§å°
SELECT
    schemaname,
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size
FROM pg_tables
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;

-- æŸ¥è©¢ç´¢å¼•ä½¿ç”¨æƒ…æ³
SELECT
    schemaname,
    tablename,
    indexname,
    idx_scan,
    idx_tup_read,
    idx_tup_fetch
FROM pg_stat_user_indexes
ORDER BY idx_scan;
```

### 2. å®šæœŸç¶­è­·ä»»å‹™

```sql
-- æ¯æ—¥åŸ·è¡Œ
VACUUM ANALYZE;

-- æ¯é€±åŸ·è¡Œ
REINDEX DATABASE employee_management;

-- æ¯æœˆåŸ·è¡Œ
-- æ¸…ç†èˆŠçš„å¯©è¨ˆæ—¥èªŒ
DELETE FROM audit_logs 
WHERE created_at < CURRENT_DATE - INTERVAL '90 days';

-- æ¸…ç†éæœŸå…¬å‘Š
UPDATE announcements 
SET is_active = FALSE 
WHERE expire_date < CURRENT_DATE AND is_active = TRUE;
```

---

## ğŸ”’ å®‰å…¨å»ºè­°

### 1. è³‡æ–™åŠ å¯†

```sql
-- ä½¿ç”¨ pgcrypto æ“´å±•åŠ å¯†æ•æ„Ÿè³‡æ–™
CREATE EXTENSION IF NOT EXISTS pgcrypto;

-- åŠ å¯†èº«åˆ†è­‰è™Ÿ
UPDATE employees 
SET id_number = pgp_sym_encrypt(id_number, 'encryption_key');

-- æŸ¥è©¢æ™‚è§£å¯†
SELECT 
    id,
    name,
    pgp_sym_decrypt(id_number::bytea, 'encryption_key') as id_number
FROM employees;
```

### 2. è¡Œç´šå®‰å…¨æ€§

```sql
-- å•Ÿç”¨è¡Œç´šå®‰å…¨æ€§
ALTER TABLE revenue_records ENABLE ROW LEVEL SECURITY;

-- å‰µå»ºç­–ç•¥ï¼šå“¡å·¥åªèƒ½çœ‹åˆ°è‡ªå·±çš„ç‡Ÿæ”¶è¨˜éŒ„
CREATE POLICY employee_revenue_policy ON revenue_records
    FOR ALL
    TO employee_role
    USING (employee_id = current_user_id());

-- ç®¡ç†å“¡å¯ä»¥çœ‹åˆ°æ‰€æœ‰è¨˜éŒ„
CREATE POLICY admin_revenue_policy ON revenue_records
    FOR ALL
    TO admin_role
    USING (true);
```

---

## ğŸ“ˆ ç¸½çµ

æœ¬è³‡æ–™åº«è¨­è¨ˆæŒ‡å—æä¾›äº†ï¼š

1. **å®Œæ•´çš„è³‡æ–™è¡¨çµæ§‹**ï¼š11å€‹æ ¸å¿ƒè³‡æ–™è¡¨ï¼Œæ¶µè“‹æ‰€æœ‰æ¥­å‹™éœ€æ±‚
2. **å„ªåŒ–çš„ç´¢å¼•ç­–ç•¥**ï¼šæå‡æŸ¥è©¢æ•ˆèƒ½
3. **æ¸…æ™°çš„é—œè¯é—œä¿‚**ï¼šç¢ºä¿è³‡æ–™å®Œæ•´æ€§
4. **å¯¦ç”¨çš„é·ç§»æ–¹æ¡ˆ**ï¼šæ”¯æ´å¤šç¨®è³‡æ–™ä¾†æº
5. **å…¨é¢çš„å®‰å…¨æ©Ÿåˆ¶**ï¼šä¿è­·æ•æ„Ÿè³‡æ–™

é€™ä»½è¨­è¨ˆå¯ä»¥ç›´æ¥ç”¨æ–¼ç”Ÿç”¢ç’°å¢ƒçš„è³‡æ–™åº«å»ºç½®ã€‚

---

**æ–‡æª”ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¥æœŸ**: 2025-01-10  
**è³‡æ–™åº«æ¶æ§‹å¸«**: AIé–‹ç™¼åœ˜éšŠ