<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>員工工作台 - 企業員工管理系統</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <script type="text/javascript">
        // 🔐 員工頁面認證驗證系統
        (function() {
            'use strict';
            
            console.log('🔐 啟動員工頁面認證檢查...');
            
            // 檢查認證狀態
            function checkAuthentication() {
                const token = localStorage.getItem('employeeToken') || sessionStorage.getItem('employeeToken');
                const employeeData = localStorage.getItem('employeeData') || sessionStorage.getItem('employeeData');
                
                console.log('🔍 檢查認證狀態:', { 
                    hasToken: !!token, 
                    hasEmployeeData: !!employeeData 
                });
                
                if (!token || !employeeData) {
                    console.log('❌ 認證失敗: 未找到有效的登入憑證');
                    
                    // 顯示認證失敗訊息
                    showAuthenticationAlert();
                    
                    // 3秒後重定向到登入頁面
                    setTimeout(() => {
                        console.log('🔄 重定向到登入頁面...');
                        window.location.href = '/login';
                    }, 3000);
                    
                    return false;
                }
                
                console.log('✅ 認證成功: 用戶已登入');
                return true;
            }
            
            // 顯示認證失敗警告
            function showAuthenticationAlert() {
                // 創建警告彈窗
                const alertDiv = document.createElement('div');
                alertDiv.id = 'auth-alert';
                alertDiv.innerHTML = `
                    <div style="
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0,0,0,0.8);
                        z-index: 9999;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-family: Arial, sans-serif;
                    ">
                        <div style="
                            background: white;
                            padding: 30px;
                            border-radius: 10px;
                            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                            text-align: center;
                            max-width: 400px;
                        ">
                            <h2 style="color: #d32f2f; margin-bottom: 20px;">
                                🔐 需要登入驗證
                            </h2>
                            <p style="color: #666; margin-bottom: 20px;">
                                您需要先登入才能訪問員工工作台
                            </p>
                            <p style="color: #999; font-size: 14px;">
                                3秒後將自動跳轉到登入頁面...
                            </p>
                            <div style="margin-top: 20px;">
                                <button onclick="window.location.href='/login'" style="
                                    background: #1976d2;
                                    color: white;
                                    border: none;
                                    padding: 10px 20px;
                                    border-radius: 5px;
                                    cursor: pointer;
                                    font-size: 16px;
                                ">
                                    立即登入
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(alertDiv);
            }
            
            // 隱藏頁面內容直到認證完成
            function hidePageContent() {
                document.body.style.visibility = 'hidden';
                document.body.style.opacity = '0';
            }
            
            // 顯示頁面內容
            function showPageContent() {
                document.body.style.visibility = 'visible';
                document.body.style.opacity = '1';
                document.body.style.transition = 'opacity 0.3s ease';
            }
            
            // DOM載入完成後執行認證檢查 (添加小延遲確保localStorage同步)
            function delayedAuthCheck() {
                hidePageContent();
                
                // 延遲500ms確保localStorage完全同步
                setTimeout(() => {
                    if (checkAuthentication()) {
                        showPageContent();
                    }
                }, 500);
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', delayedAuthCheck);
            } else {
                delayedAuthCheck();
            }
            
            // 定期檢查認證狀態 (每30秒)
            setInterval(function() {
                const token = localStorage.getItem('employeeToken') || sessionStorage.getItem('employeeToken');
                if (!token) {
                    console.log('⚠️ 認證token已失效，重定向到登入頁面...');
                    window.location.href = '/login';
                }
            }, 30000);
            
            console.log('✅ 員工頁面認證檢查系統已啟動');
        })();
        </script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="index.html">員工管理系統</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="profile.html">個人資料</a>
                <a class="nav-link" href="attendance.html">考勤打卡</a>
                <a class="nav-link" href="#" onclick="logout()">登出</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-12">
                <h2>員工工作台</h2>
                <div class="row mt-4">
                    <div class="col-md-6 col-lg-3 mb-4">
                        <div class="card bg-primary text-white">
                            <div class="card-body">
                                <h5 class="card-title">今日考勤</h5>
                                <p class="card-text">點擊進行打卡</p>
                                <a href="attendance.html" class="btn btn-light">前往打卡</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3 mb-4">
                        <div class="card bg-success text-white">
                            <div class="card-body">
                                <h5 class="card-title">營收記錄</h5>
                                <p class="card-text">查看營收統計</p>
                                <a href="revenue.html" class="btn btn-light">查看記錄</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3 mb-4">
                        <div class="card bg-info text-white">
                            <div class="card-body">
                                <h5 class="card-title">個人資料</h5>
                                <p class="card-text">管理個人信息</p>
                                <a href="profile.html" class="btn btn-light">編輯資料</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3 mb-4">
                        <div class="card bg-warning text-white">
                            <div class="card-body">
                                <h5 class="card-title">營收報表</h5>
                                <p class="card-text">查看營收統計報表資料</p>
                                <a href="revenue.html" class="btn btn-light">查看報表</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5>近期考勤記錄</h5>
                    </div>
                    <div class="card-body">
                        <div id="attendanceRecords">
                            <p class="text-muted">載入中...</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5>快速操作</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary w-100 mb-2" onclick="quickClockIn()">快速打卡</button>
                        <button class="btn btn-success w-100 mb-2" onclick="addRevenue()">新增營收</button>
                        <button class="btn btn-info w-100" onclick="viewProfile()">查看資料</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/app.js"></script>
</body>
</html>