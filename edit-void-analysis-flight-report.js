/**
 * âœˆï¸ ç·¨è¼¯ä½œå»¢åŠŸèƒ½æ·±åº¦æª¢æŸ¥ - é£›æ©Ÿå½™å ±é€šçŸ¥
 */

const https = require('https');

class EditVoidAnalysisFlightReporter {
    constructor() {
        this.telegramConfig = {
            botToken: 'process.env.TELEGRAM_BOT_TOKEN',
            chatId: 'process.env.TELEGRAM_GROUP_ID'
        };
    }

    async sendFlightReport() {
        const reportContent = `
âœˆï¸ ç·¨è¼¯ä½œå»¢åŠŸèƒ½æ·±åº¦æª¢æŸ¥ - å®Œæˆå½™å ±
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” æª¢æŸ¥ä»»å‹™: å…¨é¢æª¢æŸ¥ç·¨è¼¯ä½œå»¢åˆªé™¤æŒ‰éµåŠŸèƒ½     â”‚
â”‚ ğŸ•’ åŸ·è¡Œæ™‚é–“: ${new Date().toLocaleString('zh-TW')}           â”‚
â”‚ ğŸ“Š æª¢æŸ¥ç¯„åœ: 7å¤§åŠŸèƒ½æ¨¡çµ„å®Œæ•´é©—è­‰              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ¯ æª¢æŸ¥æˆæœç¸½çµ:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… ç™¼ç¾æŒ‰éµç¸½æ•¸: 4å€‹æœ‰åŠŸèƒ½çš„ç·¨è¼¯ä½œå»¢æŒ‰éµ
ğŸ”§ å¾Œç«¯APIæ”¯æ´: 21å€‹PUT/PATCH/DELETEç«¯é»
ğŸ§ª åŠŸèƒ½æ¸¬è©¦: å®Œæˆç€è¦½å™¨è‡ªå‹•åŒ–é©—è­‰
ğŸ›¡ï¸ æ¬Šé™æ§åˆ¶: ç¢ºèªå®‰å…¨æ©Ÿåˆ¶å®Œæ•´æ€§

ğŸš¨ é—œéµç™¼ç¾å•é¡Œ:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âŒ å€‹äººè³‡æ–™ç·¨è¼¯: å‰ç«¯é¡¯ç¤º"é–‹ç™¼ä¸­"ä½†å¾Œç«¯APIå·²å®Œæ•´
âŒ æ•¸æ“šè¡¨æ ¼ç¼ºé™·: æ‰€æœ‰è¡¨æ ¼ç„¡ç·¨è¼¯æ“ä½œæŒ‰éµ
   â€¢ æ‰“å¡è¨˜éŒ„è¡¨æ ¼ - ç„¡ç·¨è¼¯/ä½œå»¢æŒ‰éµ
   â€¢ ç‡Ÿæ”¶è¨˜éŒ„è¡¨æ ¼ - ç„¡ç·¨è¼¯/åˆªé™¤æŒ‰éµ  
   â€¢ æ’ç­è¨˜éŒ„è¡¨æ ¼ - ç„¡ä¿®æ”¹/å–æ¶ˆæŒ‰éµ
   â€¢ æŠ•ç¥¨è¨˜éŒ„è¡¨æ ¼ - ç„¡ä¿®æ”¹/æ’¤éŠ·æŒ‰éµ

âŒ åŠŸèƒ½æ–·å±¤å•é¡Œ: å‰ç«¯æŒ‰éµèˆ‡å¾Œç«¯APIæœªé€£æ¥
   â€¢ è«‹å‡æ’¤å›: åƒ…å‰ç«¯ç¢ºèªï¼Œç„¡APIèª¿ç”¨
   â€¢ ç·¨è¼¯å€‹äººè³‡æ–™: æœ‰APIç„¡å‰ç«¯å¯¦ç¾

ğŸ”§ å·²ç¢ºèªçš„å¾Œç«¯APIæ”¯æ´:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… /admin/attendance-records/:id/void - ä½œå»¢æ‰“å¡è¨˜éŒ„
âœ… /admin/revenue-records/:id/void - ä½œå»¢ç‡Ÿæ”¶è¨˜éŒ„
âœ… /api/revenue/void/:id - ä½œå»¢ç‡Ÿæ”¶è¨˜éŒ„(å“¡å·¥)
âœ… /admin/employees/:id - ç·¨è¼¯å“¡å·¥è³‡æ–™
âœ… /api/employees/profile - ç·¨è¼¯å€‹äººè³‡æ–™
âœ… /api/inventory/orders/:id/void - ä½œå»¢å«è²¨å–®
âœ… /routes/maintenance.js - ç¶­ä¿®ä»»å‹™ç·¨è¼¯

ğŸ’¡ ä¿®å¾©å»ºè­°å„ªå…ˆç´š:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš¨ ç·Šæ€¥ä¿®å¾© (ç¬¬1é€±):
   1. é€£æ¥å€‹äººè³‡æ–™ç·¨è¼¯å‰å¾Œç«¯åŠŸèƒ½
   2. ç‚ºæ‰“å¡è¨˜éŒ„è¡¨æ ¼æ·»åŠ æ“ä½œæŒ‰éµ
   3. ç‚ºç‡Ÿæ”¶è¨˜éŒ„è¡¨æ ¼æ·»åŠ æ“ä½œæŒ‰éµ
   4. å¯¦ç¾è«‹å‡ç”³è«‹æ’¤å›API

ğŸ“ˆ åŠŸèƒ½å¢å¼· (ç¬¬2é€±):
   1. æ‰¹é‡æ“ä½œåŠŸèƒ½å¯¦ç¾
   2. æ“ä½œæ­·å²è¨˜éŒ„è¿½è¹¤
   3. æ¬Šé™å‹•æ…‹æ§åˆ¶æ©Ÿåˆ¶

ğŸ›¡ï¸ å®‰å…¨å¢å¼· (ç¬¬3é€±):
   1. äºŒæ¬¡ç¢ºèªæ©Ÿåˆ¶
   2. æ“ä½œé »ç‡é™åˆ¶
   3. å®Œå–„å¯©è¨ˆæ—¥èªŒç³»çµ±

ğŸ“‹ æŠ€è¡“åˆ†ææˆæœ:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ§ª æª¢æŸ¥å·¥å…·: edit-void-function-deep-test.js
ğŸ“„ è©³ç´°å ±å‘Š: edit-void-comprehensive-analysis-report.md
ğŸ“Š JSONçµæœ: edit-void-deep-test-report-*.json
ğŸ” å¯¦éš›ç€è¦½å™¨æ¸¬è©¦: Puppeteerè‡ªå‹•åŒ–é©—è­‰å®Œæˆ

ğŸ’¾ Gitç‹€æ…‹å‚™è¨»:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ æäº¤å“ˆå¸Œ: 2458ae22
ğŸ’¬ æäº¤è¨Šæ¯: "å®Œæˆç·¨è¼¯ä½œå»¢åŠŸèƒ½æŒ‰éµæ·±åº¦æª¢æŸ¥"
ğŸ“ æ–°å¢æª”æ¡ˆ: 6å€‹æª¢æŸ¥åˆ†ææª”æ¡ˆ
ğŸ”„ ä¿®æ”¹æª”æ¡ˆ: æ¶µè“‹å‰ç«¯å’Œå¾Œç«¯åˆ†æçµæœ

ğŸ¯ ç”¨æˆ¶é—œæ³¨é‡é»è§£æ±ºç‹€æ³:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… ç·¨è¼¯æŒ‰éµåŠŸèƒ½ - å®Œæˆå…¨é¢æª¢æŸ¥å’Œåˆ†æ
âœ… ä½œå»¢æŒ‰éµåŠŸèƒ½ - ç¢ºèªå¾Œç«¯æ”¯æ´ç‹€æ³
âœ… å¯¦éš›å¯ç”¨æ€§é©—è­‰ - å®Œæˆç€è¦½å™¨è‡ªå‹•æ¸¬è©¦
âœ… æ¬Šé™å®‰å…¨æª¢æŸ¥ - ç¢ºèªæ§åˆ¶æ©Ÿåˆ¶å®Œæ•´

ğŸš€ ä¸‹ä¸€æ­¥è¡Œå‹•è¨ˆåŠƒ:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. æ ¹æ“šåˆ†æå ±å‘ŠåŸ·è¡Œç·Šæ€¥ä¿®å¾©
2. å¯¦æ–½è¡¨æ ¼æ“ä½œæŒ‰éµå¢å¼·
3. å»ºç«‹å®Œæ•´çš„ç·¨è¼¯ä½œå»¢å·¥ä½œæµç¨‹
4. å¼·åŒ–ç”¨æˆ¶é«”é©—å’Œå®‰å…¨æ©Ÿåˆ¶

ğŸ“± é€šçŸ¥ç¢ºèª: âœ… Telegramé£›æ©Ÿå½™å ±å·²ç™¼é€
ğŸ¤– Generated with [Claude Code](https://claude.ai/code)
        `.trim();

        return this.sendTelegramMessage(reportContent);
    }

    sendTelegramMessage(message) {
        return new Promise((resolve, reject) => {
            const url = `https://api.telegram.org/bot${this.telegramConfig.botToken}/sendMessage`;
            const data = JSON.stringify({
                chat_id: this.telegramConfig.chatId,
                text: message,
                parse_mode: 'HTML'
            });

            const options = {
                hostname: 'api.telegram.org',
                port: 443,
                path: `/bot${this.telegramConfig.botToken}/sendMessage`,
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Content-Length': Buffer.byteLength(data)
                }
            };

            const req = https.request(options, (res) => {
                let responseData = '';
                res.on('data', (chunk) => responseData += chunk);
                res.on('end', () => {
                    if (res.statusCode === 200) {
                        console.log('âœˆï¸ ç·¨è¼¯ä½œå»¢åŠŸèƒ½æª¢æŸ¥é£›æ©Ÿå½™å ±ç™¼é€æˆåŠŸ');
                        resolve(JSON.parse(responseData));
                    } else {
                        console.error('âŒ é£›æ©Ÿå½™å ±ç™¼é€å¤±æ•—:', res.statusCode, responseData);
                        reject(new Error(`HTTP ${res.statusCode}: ${responseData}`));
                    }
                });
            });

            req.on('error', (error) => {
                console.error('âŒ è«‹æ±‚éŒ¯èª¤:', error);
                reject(error);
            });

            req.write(data);
            req.end();
        });
    }
}

// åŸ·è¡Œé£›æ©Ÿå½™å ±
async function sendEditVoidAnalysisReport() {
    try {
        console.log('ğŸš€ é–‹å§‹ç™¼é€ç·¨è¼¯ä½œå»¢åŠŸèƒ½æª¢æŸ¥é£›æ©Ÿå½™å ±...');
        const reporter = new EditVoidAnalysisFlightReporter();
        await reporter.sendFlightReport();
        console.log('âœ… ç·¨è¼¯ä½œå»¢åŠŸèƒ½æª¢æŸ¥å½™å ±å®Œæˆ');
    } catch (error) {
        console.error('ğŸ’¥ é£›æ©Ÿå½™å ±ç™¼é€å¤±æ•—:', error.message);
    }
}

// å¦‚æœç›´æ¥é‹è¡Œæ­¤æ–‡ä»¶
if (require.main === module) {
    sendEditVoidAnalysisReport();
}

module.exports = EditVoidAnalysisFlightReporter;