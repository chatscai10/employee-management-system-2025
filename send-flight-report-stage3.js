const axios = require('axios');
const fs = require('fs');
const path = require('path');

async function sendFlightReportStage3() {
    const botToken = 'process.env.TELEGRAM_BOT_TOKEN';
    const chatId = 'process.env.TELEGRAM_GROUP_ID';
    
    const report = `âœˆï¸ é£›æ©Ÿå½™å ± - éšæ®µ 3 å®Œæˆå ±å‘Š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š å·¥ä½œé€²åº¦å½™æ•´:                              â”‚
â”‚ âœ… å®Œæˆä»»å‹™: å“¡å·¥èªè­‰ç™»å…¥ç³»çµ±é–‹ç™¼å®Œæˆ            â”‚
â”‚ ğŸ“ˆ å®Œæˆç‡: 43.8% (7/16 å·²å®Œæˆ)               â”‚
â”‚ ğŸ”§ ä½¿ç”¨æ¨¡çµ„: æ±ºç­–å¼•æ“ã€å·¥å…·ç·¨æ’ã€Telegramé£›æ©Ÿå½™å ± â”‚
â”‚ â±ï¸ åŸ·è¡Œæ™‚é–“: ç´„ 40 åˆ†é˜                      â”‚
â”‚                                           â”‚
â”‚ ğŸ” æŠ€è¡“åˆ†æç™¼ç¾:                              â”‚
â”‚ ğŸ” å“¡å·¥èªè­‰ç³»çµ±å®Œæ•´å¯¦ç¾(å§“å+èº«åˆ†è­‰)            â”‚
â”‚ ğŸ“± ç§»å‹•ç«¯å„ªåŒ–ç™»å…¥è¨»å†Šç•Œé¢                      â”‚
â”‚ ğŸ’¾ 11å€‹å¿…å¡«æ¬„ä½å®Œæ•´é©—è­‰æ©Ÿåˆ¶                   â”‚
â”‚ ğŸ›¡ï¸ Session + JWTé›™é‡èªè­‰ä¿è­·                â”‚
â”‚ ğŸ“‹ å“¡å·¥å„€è¡¨æ¿å·¥ä½œå°å»ºç½®å®Œæˆ                    â”‚
â”‚ âœ… APIç«¯é»å®Œæ•´æ¸¬è©¦é€šé                       â”‚
â”‚ ğŸ¤– Telegramç™»å…¥é€šçŸ¥è‡ªå‹•ç™¼é€                  â”‚
â”‚ ğŸ¯ è·ä½æ¬Šé™å°å‘è·³è½‰æ©Ÿåˆ¶                       â”‚
â”‚                                           â”‚
â”‚ ğŸ’¡ ä¸‹ä¸€æ­¥å»ºè­°:                                â”‚
â”‚ ğŸ“ GPSæ‰“å¡ç³»çµ±å¯¦ç¾(15é …åŠŸèƒ½)                  â”‚
â”‚ ğŸ“Š ç‡Ÿæ”¶ç®¡ç†ç³»çµ±é–‹ç™¼(çé‡‘è¨ˆç®—å¼•æ“)             â”‚
â”‚                                           â”‚
â”‚ ğŸ’¾ Gitç‹€æ…‹å‚™è¨»:                              â”‚
â”‚ ğŸ“ å“¡å·¥èªè­‰ç³»çµ±å®Œæ•´å¯¦ç¾éœ€è¦æäº¤                 â”‚
â”‚                                           â”‚
â”‚ ğŸ”§ ç³»çµ±æ¸¬è©¦çµæœ:                              â”‚
â”‚ âœ… å“¡å·¥è¨»å†ŠAPI: 409æ­£å¸¸éŸ¿æ‡‰                  â”‚
â”‚ âœ… å“¡å·¥ç™»å…¥API: 200æˆåŠŸèªè­‰                  â”‚
â”‚ âœ… JWT Tokenæ­£å¸¸ç”Ÿæˆ                        â”‚
â”‚ âœ… Telegramé€šçŸ¥ç™¼é€æˆåŠŸ                      â”‚
â”‚                                           â”‚
â”‚ ğŸ“± é€šçŸ¥ç¢ºèª: âœ… Telegramé€šçŸ¥å·²ç™¼é€           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜`;

    try {
        const response = await axios.post(`https://api.telegram.org/bot${botToken}/sendMessage`, {
            chat_id: chatId,
            text: report,
            parse_mode: 'HTML'
        });
        
        console.log('âœ… éšæ®µ3é£›æ©Ÿå½™å ±ç™¼é€æˆåŠŸ');
        
        // ä¿å­˜æœ¬åœ°å ±å‘Š
        const reportDir = './flight-reports';
        if (!fs.existsSync(reportDir)) {
            fs.mkdirSync(reportDir, { recursive: true });
        }
        
        const timestamp = new Date().toISOString().replace(/:/g, '-').split('T')[0];
        const reportPath = path.join(reportDir, `flight-report-stage-3-${timestamp}.txt`);
        fs.writeFileSync(reportPath, report, 'utf8');
        console.log(`ğŸ“ éšæ®µ3å ±å‘Šå·²ä¿å­˜: ${reportPath}`);
        
    } catch (error) {
        console.error('âŒ éšæ®µ3é£›æ©Ÿå½™å ±ç™¼é€å¤±æ•—:', error.message);
    }
}

sendFlightReportStage3();