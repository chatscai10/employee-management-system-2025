# ğŸ” ä¼æ¥­å“¡å·¥ç®¡ç†ç³»çµ± - é–‹ç™¼å ±å‘Šç¼ºå¤±åˆ†æèˆ‡æ”¹é€²å»ºè­°

## ğŸ“‹ åˆ†ææ¦‚è¿°

æœ¬æ–‡æª”å¾æ–°æ¥æ‰‹é–‹ç™¼è€…çš„è§’åº¦ï¼Œå°å·²å®Œæˆçš„6ä»½é–‹ç™¼å ±å‘Šé€²è¡Œå…¨é¢å¯©æŸ¥ï¼Œè­˜åˆ¥å‡ºéœ€è¦è£œå……æˆ–æ”¹é€²çš„é—œéµè³‡è¨Šã€‚

**åˆ†ææ™‚é–“**: 2025-08-06  
**åˆ†æè§’è‰²**: æ–°æ¥æ‰‹çš„å…¨ç«¯é–‹ç™¼è€…  
**é©—è­‰è©•åˆ†**: 70/100 (åˆæ ¼ä½†éœ€æ”¹é€²)

---

## ğŸš¨ å„ªå…ˆä¿®æ­£é …ç›® (P0 - ç«‹å³è™•ç†)

### 1. é…ç½®è³‡è¨Šä¸ä¸€è‡´å•é¡Œ

#### å•é¡Œæè¿°
- Telegramç¾¤çµ„IDåœ¨ä¸åŒæ–‡æª”ä¸­ä¸ä¸€è‡´
- APIç«¯é»æ•¸é‡èªªæ˜ä¸ç¬¦ï¼ˆè²ç¨±43å€‹ä½†å¯¦éš›åˆ—èˆ‰ä¸ç¬¦ï¼‰
- è³‡æ–™è¡¨æ•¸é‡å·®ç•°ï¼ˆ11å€‹ vs 13å€‹ï¼‰

#### ä¿®æ­£å»ºè­°
```yaml
# çµ±ä¸€é…ç½®æª” (config/system.yaml)
telegram:
  bot_token: "process.env.TELEGRAM_BOT_TOKEN"
  groups:
    boss: "process.env.TELEGRAM_GROUP_ID"
    manager: "-1002658082393"
    employee: "-1002658082394"

api:
  total_endpoints: 43
  categories:
    auth: 4
    employee: 8
    attendance: 6
    revenue: 5
    inventory: 6
    schedule: 5
    other: 9

database:
  tables:
    core: 11  # ç›®å‰å¯¦ä½œ
    planned: 13  # å®Œæ•´è¦åŠƒ
```

### 2. ç’°å¢ƒè®Šæ•¸é…ç½®ä¸å®Œæ•´

#### ç¼ºå¤±å…§å®¹
```env
# .env.example (éœ€è¦å»ºç«‹)
# === å¿…å¡«é…ç½® ===
NODE_ENV=development
PORT=3000
JWT_SECRET=your-super-secret-key-change-this

# === è³‡æ–™åº«é…ç½® ===
DB_TYPE=memory  # memory | postgres | mysql
DB_HOST=localhost
DB_PORT=5432
DB_NAME=employee_management
DB_USER=
DB_PASSWORD=

# === Telegramé…ç½® (é¸å¡«) ===
TELEGRAM_BOT_TOKEN=
TELEGRAM_BOSS_GROUP_ID=
TELEGRAM_MANAGER_GROUP_ID=
TELEGRAM_EMPLOYEE_GROUP_ID=

# === GPSé…ç½® ===
GPS_RADIUS=100  # å…¬å°º
GPS_ACCURACY_THRESHOLD=50  # å…¬å°º
LOCATION_TIMEOUT=30000  # æ¯«ç§’

# === æª”æ¡ˆä¸Šå‚³é…ç½® ===
MAX_FILE_SIZE=5242880  # 5MB
ALLOWED_FILE_TYPES=jpg,jpeg,png,webp
IMAGE_COMPRESSION_QUALITY=80

# === æ•ˆèƒ½é…ç½® ===
API_RATE_LIMIT=100  # æ¯åˆ†é˜è«‹æ±‚æ•¸
CACHE_TTL=300  # ç§’
SESSION_TIMEOUT=3600000  # æ¯«ç§’
```

---

## ğŸ”§ æŠ€è¡“ç´°ç¯€è£œå…… (P1 - å„ªå…ˆè™•ç†)

### 1. GPSæ‰“å¡å®Œæ•´å¯¦ç¾

#### å®šä½å¤±æ•—è™•ç†é‚è¼¯
```javascript
async function handleClockIn(employeeId, storeLocation) {
  try {
    // 1. å˜—è©¦ç²å–GPSå®šä½
    const position = await getCurrentPosition({
      enableHighAccuracy: true,
      timeout: 30000,
      maximumAge: 0
    });
    
    // 2. é©—è­‰å®šä½ç²¾åº¦
    if (position.coords.accuracy > 50) {
      // ç²¾åº¦ä¸è¶³ï¼Œè¦æ±‚é‡æ–°å®šä½
      return {
        success: false,
        message: "GPSå®šä½ç²¾åº¦ä¸è¶³ï¼Œè«‹ç§»å‹•åˆ°é–‹é—Šåœ°å¸¶é‡è©¦",
        accuracy: position.coords.accuracy
      };
    }
    
    // 3. è¨ˆç®—è·é›¢
    const distance = calculateDistance(
      position.coords.latitude,
      position.coords.longitude,
      storeLocation.lat,
      storeLocation.lng
    );
    
    // 4. é˜²ä½œå¼Šé©—è­‰
    const antiCheat = await validateAntiCheat({
      deviceFingerprint: generateFingerprint(),
      networkInfo: getNetworkInfo(),
      accelerometer: getDeviceMotion(),
      previousLocations: await getRecentLocations(employeeId)
    });
    
    if (!antiCheat.valid) {
      return {
        success: false,
        message: "æª¢æ¸¬åˆ°ç•°å¸¸è¡Œç‚º",
        reason: antiCheat.reason
      };
    }
    
    // 5. é›¢ç·šå¿«å–æ©Ÿåˆ¶
    if (!navigator.onLine) {
      await cacheClockInData({
        employeeId,
        timestamp: new Date(),
        location: position.coords,
        type: 'offline'
      });
      
      return {
        success: true,
        message: "å·²é›¢ç·šå„²å­˜ï¼Œç¶²è·¯æ¢å¾©å¾Œè‡ªå‹•ä¸Šå‚³",
        offline: true
      };
    }
    
    // 6. æ­£å¸¸æ‰“å¡
    return await submitClockIn({
      employeeId,
      location: position.coords,
      distance,
      deviceInfo: antiCheat.deviceInfo
    });
    
  } catch (error) {
    // 7. éŒ¯èª¤è™•ç†
    if (error.code === 1) {
      return { success: false, message: "è«‹é–‹å•Ÿå®šä½æ¬Šé™" };
    } else if (error.code === 2) {
      return { success: false, message: "ç„¡æ³•ç²å–ä½ç½®è³‡è¨Š" };
    } else if (error.code === 3) {
      return { success: false, message: "å®šä½è¶…æ™‚ï¼Œè«‹æª¢æŸ¥ç¶²è·¯" };
    }
    
    return { success: false, message: "ç³»çµ±éŒ¯èª¤", error: error.message };
  }
}
```

### 2. æª”æ¡ˆä¸Šå‚³æœ€ä½³å¯¦è¸

#### åœ–ç‰‡è™•ç†æµç¨‹
```javascript
class ImageUploadService {
  constructor() {
    this.maxSize = 5 * 1024 * 1024; // 5MB
    this.allowedTypes = ['image/jpeg', 'image/png', 'image/webp'];
    this.compressionQuality = 0.8;
  }
  
  async processImage(file) {
    // 1. é©—è­‰æª”æ¡ˆ
    this.validateFile(file);
    
    // 2. å£“ç¸®åœ–ç‰‡
    const compressed = await this.compressImage(file);
    
    // 3. ç”Ÿæˆå”¯ä¸€æª”å
    const filename = this.generateFilename(file);
    
    // 4. ä¸Šå‚³åˆ°å„²å­˜æœå‹™
    const uploadResult = await this.uploadToStorage(compressed, filename);
    
    // 5. ç”Ÿæˆç¸®åœ–
    const thumbnail = await this.generateThumbnail(compressed);
    
    // 6. è¿”å›çµæœ
    return {
      url: uploadResult.url,
      thumbnailUrl: uploadResult.thumbnailUrl,
      size: compressed.size,
      type: compressed.type,
      dimensions: await this.getImageDimensions(compressed)
    };
  }
  
  async compressImage(file) {
    return new Promise((resolve) => {
      const reader = new FileReader();
      reader.onload = (e) => {
        const img = new Image();
        img.onload = () => {
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          
          // è¨ˆç®—æ–°å°ºå¯¸ï¼ˆæœ€å¤§1920x1080ï¼‰
          const maxWidth = 1920;
          const maxHeight = 1080;
          let { width, height } = img;
          
          if (width > maxWidth || height > maxHeight) {
            const ratio = Math.min(maxWidth / width, maxHeight / height);
            width *= ratio;
            height *= ratio;
          }
          
          canvas.width = width;
          canvas.height = height;
          ctx.drawImage(img, 0, 0, width, height);
          
          canvas.toBlob((blob) => {
            resolve(new File([blob], file.name, {
              type: 'image/jpeg',
              lastModified: Date.now()
            }));
          }, 'image/jpeg', this.compressionQuality);
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    });
  }
  
  generateFilename(file) {
    const timestamp = Date.now();
    const random = Math.random().toString(36).substring(7);
    const extension = file.name.split('.').pop();
    return `${timestamp}-${random}.${extension}`;
  }
}
```

---

## ğŸ“‹ æ¥­å‹™é‚è¼¯è©³ç´°èªªæ˜ (P2 - é‡è¦è™•ç†)

### 1. è€ƒå‹¤ç®¡ç†å®Œæ•´æµç¨‹

#### è·¨æ—¥ç­æ¬¡è™•ç†
```javascript
class ShiftCalculator {
  calculateWorkHours(clockIn, clockOut, shiftType) {
    const shift = this.getShiftConfig(shiftType);
    
    // è™•ç†è·¨æ—¥ç­æ¬¡
    if (shift.crossDay) {
      const baseDate = new Date(clockIn);
      let endDate = new Date(clockOut);
      
      // å¦‚æœä¸‹ç­æ™‚é–“æ—©æ–¼ä¸Šç­æ™‚é–“ï¼Œè¡¨ç¤ºè·¨æ—¥
      if (endDate.getHours() < baseDate.getHours()) {
        endDate.setDate(endDate.getDate() + 1);
      }
      
      // è¨ˆç®—ç¸½å·¥æ™‚
      const totalMinutes = (endDate - baseDate) / 60000;
      
      // æ‰£é™¤ä¼‘æ¯æ™‚é–“
      const breakMinutes = this.calculateBreakTime(totalMinutes);
      const workMinutes = totalMinutes - breakMinutes;
      
      // è¨ˆç®—åŠ ç­
      const regularHours = shift.regularHours * 60;
      const overtimeMinutes = Math.max(0, workMinutes - regularHours);
      
      return {
        totalHours: workMinutes / 60,
        regularHours: Math.min(workMinutes, regularHours) / 60,
        overtimeHours: overtimeMinutes / 60,
        nightShiftHours: this.calculateNightHours(baseDate, endDate),
        breakHours: breakMinutes / 60
      };
    }
  }
  
  calculateNightHours(start, end) {
    // å¤œç­æ™‚æ®µï¼š22:00 - 06:00
    const nightStart = 22;
    const nightEnd = 6;
    let nightMinutes = 0;
    
    // è¨ˆç®—é‚è¼¯...
    return nightMinutes / 60;
  }
}
```

#### è«‹å‡å¯©æ‰¹æµç¨‹
```javascript
const leaveApprovalFlow = {
  // è«‹å‡é¡å‹å®šç¾©
  leaveTypes: {
    annual: { name: 'å¹´å‡', requiresDays: 3, maxDays: 14 },
    sick: { name: 'ç—…å‡', requiresDays: 0, maxDays: 30 },
    personal: { name: 'äº‹å‡', requiresDays: 1, maxDays: 7 },
    maternity: { name: 'ç”¢å‡', requiresDays: 30, maxDays: 90 },
    funeral: { name: 'å–ªå‡', requiresDays: 0, maxDays: 7 }
  },
  
  // å¯©æ‰¹æµç¨‹
  approvalChain: {
    employee: {
      annual: ['direct_manager', 'hr'],
      sick: ['direct_manager'],
      personal: ['direct_manager'],
      maternity: ['direct_manager', 'hr', 'ceo'],
      funeral: ['direct_manager']
    },
    manager: {
      all: ['department_head', 'hr']
    }
  },
  
  // è‡ªå‹•å¯©æ‰¹è¦å‰‡
  autoApprovalRules: {
    sick: {
      condition: 'days <= 2 && hasmedicalCertificate',
      action: 'auto_approve'
    }
  }
};
```

### 2. ç‡Ÿæ”¶çé‡‘è¨ˆç®—è©³ç´°è¦å‰‡

```javascript
class BonusCalculator {
  constructor() {
    this.rules = {
      // åŸºç¤çé‡‘è¦å‰‡
      achievement: [
        { min: 1.5, rate: 0.05 },  // 150%+ = 5%
        { min: 1.3, rate: 0.03 },  // 130%+ = 3%
        { min: 1.1, rate: 0.02 },  // 110%+ = 2%
        { min: 1.0, rate: 0.01 }   // 100%+ = 1%
      ],
      
      // ç‰¹æ®Šçé‡‘è¦å‰‡
      special: {
        newRecord: 0.02,      // å‰µæ–°é«˜é¡å¤–2%
        consistency: 0.01,    // é€£çºŒ3å€‹æœˆé”æ¨™é¡å¤–1%
        teamwork: 0.005      // åœ˜éšŠæ•´é«”é”æ¨™é¡å¤–0.5%
      },
      
      // æ‰£æ¸›è¦å‰‡
      penalties: {
        customerComplaint: -0.005,  // å®¢è¨´æ‰£0.5%
        latePenalty: -0.002,       // é²åˆ°æ‰£0.2%
        absencePenalty: -0.01      // æ› è·æ‰£1%
      }
    };
  }
  
  calculateBonus(employee, monthData) {
    const base = this.calculateBaseBonus(monthData);
    const special = this.calculateSpecialBonus(employee, monthData);
    const penalties = this.calculatePenalties(employee, monthData);
    
    const totalRate = base + special + penalties;
    const bonusAmount = monthData.netRevenue * Math.max(0, totalRate);
    
    return {
      baseRate: base,
      specialRate: special,
      penaltyRate: penalties,
      totalRate: Math.max(0, totalRate),
      amount: Math.round(bonusAmount),
      details: this.generateBonusDetails(employee, monthData)
    };
  }
}
```

---

## ğŸš€ éƒ¨ç½²ç¶­é‹è£œå……æ–‡æª” (P3 - å»ºè­°è™•ç†)

### 1. ç”Ÿç”¢ç’°å¢ƒéœ€æ±‚è¦æ ¼

```yaml
# production-requirements.yaml
hardware:
  web_server:
    cpu: 4 cores
    ram: 8GB
    storage: 100GB SSD
    network: 100Mbps
    
  database_server:
    cpu: 8 cores
    ram: 16GB
    storage: 500GB SSD
    network: 1Gbps
    
  cache_server:
    cpu: 2 cores
    ram: 4GB
    storage: 50GB SSD

software:
  os: Ubuntu 22.04 LTS
  node: 20.x LTS
  postgresql: 15.x
  redis: 7.x
  nginx: 1.24.x
  
security:
  firewall:
    - 22/tcp (SSH - restricted)
    - 80/tcp (HTTP)
    - 443/tcp (HTTPS)
    - 5432/tcp (PostgreSQL - internal only)
    - 6379/tcp (Redis - internal only)
    
  ssl:
    provider: Let's Encrypt
    renewal: Auto (certbot)
    
monitoring:
  - Prometheus
  - Grafana
  - ELK Stack
```

### 2. ç›£æ§å‘Šè­¦é…ç½®

```javascript
// monitoring-config.js
const alertRules = {
  // ç³»çµ±è³‡æºå‘Šè­¦
  system: {
    cpuUsage: { threshold: 80, duration: '5m', severity: 'warning' },
    memoryUsage: { threshold: 85, duration: '5m', severity: 'warning' },
    diskUsage: { threshold: 90, duration: '5m', severity: 'critical' }
  },
  
  // æ‡‰ç”¨ç¨‹å¼å‘Šè­¦
  application: {
    errorRate: { threshold: 5, duration: '5m', severity: 'warning' },
    responseTime: { threshold: 1000, duration: '10m', severity: 'warning' },
    activeUsers: { threshold: 1000, duration: '5m', severity: 'info' }
  },
  
  // æ¥­å‹™å‘Šè­¦
  business: {
    failedLogins: { threshold: 10, duration: '5m', severity: 'warning' },
    failedClockIns: { threshold: 20, duration: '10m', severity: 'critical' },
    revenueAnomaly: { threshold: 0.5, duration: '1h', severity: 'info' }
  }
};
```

### 3. ç½é›£æ¢å¾©ç¨‹åº

```markdown
## ç½é›£æ¢å¾©æ¨™æº–ä½œæ¥­ç¨‹åº (SOP)

### RTO/RPO ç›®æ¨™
- RTO (Recovery Time Objective): 4å°æ™‚
- RPO (Recovery Point Objective): 1å°æ™‚

### å‚™ä»½ç­–ç•¥
1. **è³‡æ–™åº«å‚™ä»½**
   - å…¨å‚™ä»½ï¼šæ¯æ—¥å‡Œæ™¨2é»
   - å¢é‡å‚™ä»½ï¼šæ¯å°æ™‚
   - ä¿ç•™æœŸé™ï¼š30å¤©

2. **æª”æ¡ˆç³»çµ±å‚™ä»½**
   - ä¸Šå‚³æª”æ¡ˆï¼šå³æ™‚åŒæ­¥åˆ°S3
   - ç³»çµ±è¨­å®šï¼šæ¯æ—¥å‚™ä»½
   - ç¨‹å¼ç¢¼ï¼šGit repository

### æ¢å¾©ç¨‹åº
1. **è©•ä¼°æå®³** (15åˆ†é˜)
2. **å•Ÿå‹•å‚™æ´ç³»çµ±** (30åˆ†é˜)
3. **è³‡æ–™æ¢å¾©** (2å°æ™‚)
4. **ç³»çµ±é©—è­‰** (1å°æ™‚)
5. **åˆ‡æ›ç”Ÿç”¢** (15åˆ†é˜)
```

---

## ğŸ”’ å®‰å…¨åŠ å›ºå»ºè­°

### 1. APIå®‰å…¨å¢å¼·

```javascript
// security-middleware.js
const securityHeaders = {
  'Strict-Transport-Security': 'max-age=31536000; includeSubDomains',
  'X-Content-Type-Options': 'nosniff',
  'X-Frame-Options': 'DENY',
  'X-XSS-Protection': '1; mode=block',
  'Content-Security-Policy': "default-src 'self'",
  'Referrer-Policy': 'strict-origin-when-cross-origin'
};

// Rate limiting é…ç½®
const rateLimitRules = {
  global: { windowMs: 60000, max: 100 },
  auth: { windowMs: 900000, max: 5 },  // 15åˆ†é˜5æ¬¡
  api: { windowMs: 60000, max: 60 },
  upload: { windowMs: 3600000, max: 10 }  // æ¯å°æ™‚10æ¬¡
};
```

### 2. è³‡æ–™åŠ å¯†ç­–ç•¥

```javascript
// encryption-service.js
class EncryptionService {
  constructor() {
    this.algorithm = 'aes-256-gcm';
    this.keyDerivation = 'pbkdf2';
    this.iterations = 100000;
  }
  
  // æ•æ„Ÿè³‡æ–™åŠ å¯†
  encryptSensitiveData(data, type) {
    switch(type) {
      case 'idNumber':
        return this.encryptWithFormat(data, 'XXX****XXX');
      case 'phone':
        return this.encryptWithFormat(data, 'XXXX***XXX');
      case 'salary':
        return this.encryptNumeric(data);
      default:
        return this.encrypt(data);
    }
  }
}
```

---

## ğŸ“Š æ•ˆèƒ½å„ªåŒ–å…·é«”æ–¹æ¡ˆ

### 1. è³‡æ–™åº«æŸ¥è©¢å„ªåŒ–

```sql
-- å»ºç«‹å¿…è¦ç´¢å¼•
CREATE INDEX idx_attendance_employee_date ON attendance_records(employee_id, clock_time);
CREATE INDEX idx_revenue_store_date ON revenue_records(store_name, revenue_date);
CREATE INDEX idx_employees_active ON employees(status) WHERE status = 'active';

-- æŸ¥è©¢å„ªåŒ–ç¯„ä¾‹
-- åŸå§‹æŸ¥è©¢ï¼ˆæ…¢ï¼‰
SELECT * FROM attendance_records WHERE employee_id = 1 ORDER BY clock_time DESC;

-- å„ªåŒ–å¾Œï¼ˆå¿«ï¼‰
SELECT * FROM attendance_records 
WHERE employee_id = 1 
  AND clock_time >= CURRENT_DATE - INTERVAL '30 days'
ORDER BY clock_time DESC
LIMIT 50;
```

### 2. å¿«å–ç­–ç•¥å¯¦æ–½

```javascript
// cache-strategy.js
const cacheConfig = {
  // ä½¿ç”¨è€…è³‡æ–™å¿«å–ï¼ˆè¼ƒé•·æ™‚é–“ï¼‰
  user: {
    ttl: 3600,  // 1å°æ™‚
    key: (id) => `user:${id}`,
    invalidate: ['update', 'delete']
  },
  
  // çµ±è¨ˆè³‡æ–™å¿«å–ï¼ˆä¸­ç­‰æ™‚é–“ï¼‰
  statistics: {
    ttl: 300,  // 5åˆ†é˜
    key: (type, date) => `stats:${type}:${date}`,
    invalidate: ['revenue_update', 'attendance_update']
  },
  
  // å³æ™‚è³‡æ–™å¿«å–ï¼ˆçŸ­æ™‚é–“ï¼‰
  realtime: {
    ttl: 30,  // 30ç§’
    key: (type) => `realtime:${type}`,
    invalidate: ['any_update']
  }
};
```

---

## ğŸ¯ ç¸½çµèˆ‡è¡Œå‹•è¨ˆåŠƒ

### ç«‹å³è¡Œå‹•é …ç›®
1. çµ±ä¸€æ‰€æœ‰é…ç½®è³‡è¨Šï¼Œå»ºç«‹å–®ä¸€äº‹å¯¦ä¾†æº
2. å»ºç«‹å®Œæ•´çš„ `.env.example` æª”æ¡ˆ
3. è£œå……GPSæ‰“å¡çš„å®Œæ•´éŒ¯èª¤è™•ç†é‚è¼¯

### çŸ­æœŸæ”¹é€²é …ç›®ï¼ˆ1é€±å…§ï¼‰
1. å®Œå–„æª”æ¡ˆä¸Šå‚³çš„å®‰å…¨æ€§å’Œæ•ˆèƒ½
2. è©³ç´°å®šç¾©æ‰€æœ‰æ¥­å‹™æµç¨‹çš„é‚Šç•Œæƒ…æ³
3. å»ºç«‹åŸºæœ¬çš„ç›£æ§å’Œå‘Šè­¦æ©Ÿåˆ¶

### ä¸­æœŸå„ªåŒ–é …ç›®ï¼ˆ1å€‹æœˆå…§ï¼‰
1. å¯¦æ–½å®Œæ•´çš„å®‰å…¨åŠ å›ºæ–¹æ¡ˆ
2. å„ªåŒ–è³‡æ–™åº«æŸ¥è©¢å’Œå»ºç«‹é©ç•¶ç´¢å¼•
3. å»ºç«‹è‡ªå‹•åŒ–æ¸¬è©¦å¥—ä»¶

### é•·æœŸè¦åŠƒé …ç›®
1. å°å…¥å¾®æœå‹™æ¶æ§‹
2. å¯¦æ–½ CI/CD å®Œæ•´æµç¨‹
3. å»ºç«‹ç½é›£æ¢å¾©æ¼”ç·´æ©Ÿåˆ¶

---

**æ–‡æª”ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¥æœŸ**: 2025-08-06  
**åˆ†æè€…**: æ–°æ¥æ‰‹é–‹ç™¼åœ˜éšŠ