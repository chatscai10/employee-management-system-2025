<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>營收管理 - 企業員工管理系統</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .revenue-card {
            transition: all 0.3s ease;
            border-left: 4px solid #007bff;
        }
        .revenue-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        .bonus-qualified {
            color: #28a745;
            font-weight: bold;
        }
        .bonus-not-qualified {
            color: #dc3545;
            font-weight: bold;
        }
        .revenue-form {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .revenue-stats {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .nav-tabs .nav-link {
            color: #495057;
            font-weight: 500;
        }
        .nav-tabs .nav-link.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
        .table-hover tbody tr:hover {
            background-color: #f8f9fa;
        }
        .revenue-summary-card {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .loading-spinner {
            display: none;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container-fluid mt-4">
        <!-- 頁面標題 -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2><i class="fas fa-chart-line me-2"></i>營收管理系統</h2>
                        <p class="text-muted mb-0">基於系統邏輯.txt規格 - 智能獎金計算引擎</p>
                    </div>
                    <div>
                        <button class="btn btn-secondary" onclick="loadRevenueData()">
                            <i class="fas fa-sync-alt me-1"></i>重新載入
                        </button>
                        <a href="admin.html" class="btn btn-outline-primary">
                            <i class="fas fa-arrow-left me-1"></i>返回管理頁面
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- 營收統計卡片 -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="revenue-summary-card text-center">
                    <i class="fas fa-dollar-sign fa-2x mb-2"></i>
                    <h5>今日總營收</h5>
                    <h3 id="todayRevenue">載入中...</h3>
                </div>
            </div>
            <div class="col-md-3">
                <div class="revenue-summary-card text-center" style="background: linear-gradient(45deg, #fd7e14, #ffc107);">
                    <i class="fas fa-gift fa-2x mb-2"></i>
                    <h5>今日獎金</h5>
                    <h3 id="todayBonus">載入中...</h3>
                </div>
            </div>
            <div class="col-md-3">
                <div class="revenue-summary-card text-center" style="background: linear-gradient(45deg, #6f42c1, #e83e8c);">
                    <i class="fas fa-shopping-cart fa-2x mb-2"></i>
                    <h5>今日訂單</h5>
                    <h3 id="todayOrders">載入中...</h3>
                </div>
            </div>
            <div class="col-md-3">
                <div class="revenue-summary-card text-center" style="background: linear-gradient(45deg, #17a2b8, #6610f2);">
                    <i class="fas fa-chart-bar fa-2x mb-2"></i>
                    <h5>本月營收</h5>
                    <h3 id="monthlyRevenue">載入中...</h3>
                </div>
            </div>
        </div>

        <!-- 主要內容區域 -->
        <div class="row">
            <div class="col-12">
                <!-- 標籤頁導航 -->
                <ul class="nav nav-tabs" id="revenueTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="submit-tab" data-bs-toggle="tab" data-bs-target="#submit" type="button" role="tab">
                            <i class="fas fa-plus me-1"></i>提交營收
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="records-tab" data-bs-toggle="tab" data-bs-target="#records" type="button" role="tab">
                            <i class="fas fa-list me-1"></i>營收記錄
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="calculator-tab" data-bs-toggle="tab" data-bs-target="#calculator" type="button" role="tab">
                            <i class="fas fa-calculator me-1"></i>獎金計算器
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="statistics-tab" data-bs-toggle="tab" data-bs-target="#statistics" type="button" role="tab">
                            <i class="fas fa-chart-pie me-1"></i>統計分析
                        </button>
                    </li>
                </ul>

                <!-- 標籤頁內容 -->
                <div class="tab-content" id="revenueTabContent">
                    <!-- 提交營收標籤頁 -->
                    <div class="tab-pane fade show active" id="submit" role="tabpanel">
                        <div class="card mt-3">
                            <div class="card-header">
                                <h5><i class="fas fa-upload me-2"></i>提交營收記錄</h5>
                            </div>
                            <div class="card-body">
                                <form id="revenueSubmitForm">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">分店名稱 *</label>
                                                <select id="storeName" class="form-select" required>
                                                    <option value="">請選擇分店</option>
                                                    <option value="總店">總店</option>
                                                    <option value="西門分店">西門分店</option>
                                                    <option value="信義分店">信義分店</option>
                                                    <option value="台中分店">台中分店</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">營收日期 *</label>
                                                <input type="date" id="revenueDate" class="form-control" required>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">獎金類別 *</label>
                                                <select id="bonusType" class="form-select" required>
                                                    <option value="">請選擇獎金類別</option>
                                                    <option value="平日獎金">平日獎金 (超過13,000元取30%)</option>
                                                    <option value="假日獎金">假日獎金 (任何金額取38%)</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">提交員工</label>
                                                <input type="text" id="employeeName" class="form-control" readonly value="系統用戶">
                                                <input type="hidden" id="employeeId" value="1">
                                            </div>
                                        </div>
                                    </div>

                                    <hr>
                                    <h6><i class="fas fa-money-bill-wave me-2"></i>營收明細</h6>
                                    
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">現場營業額 *</label>
                                                <div class="input-group">
                                                    <span class="input-group-text">$</span>
                                                    <input type="number" id="cashRevenue" class="form-control" min="0" step="1" placeholder="0" required>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">熊貓點餐 (35%手續費)</label>
                                                <div class="input-group">
                                                    <span class="input-group-text">$</span>
                                                    <input type="number" id="pandaRevenue" class="form-control" min="0" step="1" placeholder="0">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">UBER外送 (35%手續費)</label>
                                                <div class="input-group">
                                                    <span class="input-group-text">$</span>
                                                    <input type="number" id="uberRevenue" class="form-control" min="0" step="1" placeholder="0">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <hr>
                                    <h6><i class="fas fa-receipt me-2"></i>訂單數量</h6>
                                    
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">現場訂單數</label>
                                                <input type="number" id="cashOrders" class="form-control" min="0" step="1" placeholder="0">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">熊貓訂單數</label>
                                                <input type="number" id="pandaOrders" class="form-control" min="0" step="1" placeholder="0">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">UBER訂單數</label>
                                                <input type="number" id="uberOrders" class="form-control" min="0" step="1" placeholder="0">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">備註</label>
                                        <textarea id="revenueNotes" class="form-control" rows="3" placeholder="輸入備註..."></textarea>
                                    </div>

                                    <!-- 即時計算顯示 -->
                                    <div id="realTimeCalculation" class="alert alert-info" style="display: none;">
                                        <h6><i class="fas fa-calculator me-2"></i>即時計算結果</h6>
                                        <div id="calculationDetails"></div>
                                    </div>

                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-primary btn-lg">
                                            <i class="fas fa-paper-plane me-2"></i>提交營收記錄
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- 營收記錄標籤頁 -->
                    <div class="tab-pane fade" id="records" role="tabpanel">
                        <div class="card mt-3">
                            <div class="card-header">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h5><i class="fas fa-table me-2"></i>營收記錄列表</h5>
                                    </div>
                                    <div class="col-md-6 text-end">
                                        <button class="btn btn-outline-primary btn-sm" onclick="exportRevenueData()">
                                            <i class="fas fa-download me-1"></i>匯出數據
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <!-- 篩選器 -->
                                <div class="row mb-3">
                                    <div class="col-md-3">
                                        <select id="filterStore" class="form-select">
                                            <option value="">全部分店</option>
                                            <option value="總店">總店</option>
                                            <option value="西門分店">西門分店</option>
                                            <option value="信義分店">信義分店</option>
                                            <option value="台中分店">台中分店</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <select id="filterBonusType" class="form-select">
                                            <option value="">全部獎金類別</option>
                                            <option value="平日獎金">平日獎金</option>
                                            <option value="假日獎金">假日獎金</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <input type="date" id="filterStartDate" class="form-control" placeholder="開始日期">
                                    </div>
                                    <div class="col-md-3">
                                        <input type="date" id="filterEndDate" class="form-control" placeholder="結束日期">
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-12 text-end">
                                        <button class="btn btn-primary" onclick="applyRevenueFilters()">
                                            <i class="fas fa-filter me-1"></i>套用篩選
                                        </button>
                                        <button class="btn btn-secondary" onclick="resetRevenueFilters()">
                                            <i class="fas fa-undo me-1"></i>重設
                                        </button>
                                    </div>
                                </div>

                                <!-- 記錄表格 -->
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead class="table-dark">
                                            <tr>
                                                <th>日期</th>
                                                <th>分店</th>
                                                <th>提交員工</th>
                                                <th>獎金類別</th>
                                                <th>總營收</th>
                                                <th>有效營收</th>
                                                <th>獎金金額</th>
                                                <th>達標狀態</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody id="revenueRecordsTable">
                                            <tr>
                                                <td colspan="9" class="text-center">
                                                    <div class="loading-spinner">
                                                        <i class="fas fa-spinner fa-spin me-2"></i>載入中...
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- 分頁 -->
                                <nav>
                                    <ul class="pagination justify-content-center" id="revenueRecordsPagination">
                                        <!-- 分頁將由JavaScript動態生成 -->
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>

                    <!-- 獎金計算器標籤頁 -->
                    <div class="tab-pane fade" id="calculator" role="tabpanel">
                        <div class="card mt-3">
                            <div class="card-header">
                                <h5><i class="fas fa-calculator me-2"></i>獎金計算器</h5>
                                <small class="text-muted">測試獎金計算公式 - 平日獎金 (超過13,000元取30%) / 假日獎金 (任何金額取38%)</small>
                            </div>
                            <div class="card-body">
                                <form id="bonusCalculatorForm">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">現場營業額</label>
                                                <div class="input-group">
                                                    <span class="input-group-text">$</span>
                                                    <input type="number" id="calcCashRevenue" class="form-control" min="0" step="1" placeholder="0">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">熊貓點餐</label>
                                                <div class="input-group">
                                                    <span class="input-group-text">$</span>
                                                    <input type="number" id="calcPandaRevenue" class="form-control" min="0" step="1" placeholder="0">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">UBER外送</label>
                                                <div class="input-group">
                                                    <span class="input-group-text">$</span>
                                                    <input type="number" id="calcUberRevenue" class="form-control" min="0" step="1" placeholder="0">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">獎金類別</label>
                                                <select id="calcBonusType" class="form-select">
                                                    <option value="auto">自動判斷 (根據日期)</option>
                                                    <option value="平日獎金">平日獎金</option>
                                                    <option value="假日獎金">假日獎金</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-success btn-lg">
                                            <i class="fas fa-calculator me-2"></i>計算獎金
                                        </button>
                                    </div>
                                </form>

                                <!-- 計算結果 -->
                                <div id="calculatorResult" class="mt-4" style="display: none;">
                                    <div class="alert alert-success">
                                        <h6><i class="fas fa-chart-line me-2"></i>計算結果</h6>
                                        <div id="calculatorDetails"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 統計分析標籤頁 -->
                    <div class="tab-pane fade" id="statistics" role="tabpanel">
                        <div class="card mt-3">
                            <div class="card-header">
                                <h5><i class="fas fa-chart-pie me-2"></i>營收統計分析</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <canvas id="revenueChart" width="400" height="200"></canvas>
                                    </div>
                                    <div class="col-md-6">
                                        <canvas id="bonusChart" width="400" height="200"></canvas>
                                    </div>
                                </div>
                                
                                <hr>
                                
                                <div id="storesSummary">
                                    <h6><i class="fas fa-store me-2"></i>各分店營收摘要</h6>
                                    <div id="storesSummaryContent">
                                        <div class="text-center">
                                            <i class="fas fa-spinner fa-spin me-2"></i>載入中...
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 詳細資訊模態框 -->
    <div class="modal fade" id="revenueDetailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-info-circle me-2"></i>營收記錄詳細資訊</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="revenueDetailContent">
                    <!-- 詳細內容將由JavaScript填入 -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" onclick="voidRevenueRecord()">
                        <i class="fas fa-trash me-1"></i>作廢記錄
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/revenue-management.js"></script>
</body>
</html>