<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>企業員工管理系統 - 員工工作台</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary-color: #3b82f6;
            --secondary-color: #1d4ed8;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #06b6d4;
            --dark-color: #1f2937;
            --light-color: #f9fafb;
            --sidebar-width: 280px;
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            color: #374151;
        }

        /* 側邊欄樣式 */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: var(--sidebar-width);
            height: 100vh;
            background: linear-gradient(180deg, #1f2937 0%, #111827 100%);
            border-right: 1px solid #374151;
            transition: transform 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }

        .sidebar.collapsed {
            transform: translateX(-100%);
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid #374151;
            background: rgba(59, 130, 246, 0.1);
        }

        .sidebar-header h2 {
            color: #f9fafb;
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .sidebar-header .user-info {
            color: #9ca3af;
            font-size: 0.875rem;
        }

        .sidebar-nav {
            padding: 1rem 0;
        }

        .nav-item {
            margin-bottom: 0.25rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: #d1d5db;
            text-decoration: none;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .nav-link:hover {
            background: rgba(59, 130, 246, 0.1);
            color: #f9fafb;
            border-left-color: var(--primary-color);
        }

        .nav-link.active {
            background: rgba(59, 130, 246, 0.2);
            color: #f9fafb;
            border-left-color: var(--primary-color);
        }

        .nav-link i {
            margin-right: 0.75rem;
            width: 20px;
            text-align: center;
        }

        .nav-category {
            padding: 1rem 1.5rem 0.5rem;
            color: #6b7280;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* 主內容區域 */
        .main-content {
            margin-left: var(--sidebar-width);
            transition: margin-left 0.3s ease;
            min-height: 100vh;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        /* 頂部標題欄 */
        .top-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .menu-toggle {
            background: none;
            border: none;
            font-size: 1.25rem;
            color: #6b7280;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.375rem;
            transition: all 0.2s ease;
        }

        .menu-toggle:hover {
            background: #f3f4f6;
            color: #374151;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1f2937;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .notification-btn, .user-menu-btn {
            background: none;
            border: none;
            padding: 0.5rem;
            border-radius: 50%;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .notification-btn:hover, .user-menu-btn:hover {
            background: #f3f4f6;
            color: #374151;
        }

        .notification-badge {
            position: absolute;
            top: 0.25rem;
            right: 0.25rem;
            background: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.625rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* 內容區域 */
        .content-area {
            padding: 2rem;
            background: var(--light-color);
            min-height: calc(100vh - 80px);
        }

        /* 卡片樣式 */
        .dashboard-card {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            transition: all 0.2s ease;
            height: 100%;
        }

        .dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
        }

        .stat-card.success {
            background: linear-gradient(135deg, var(--success-color), #059669);
        }

        .stat-card.warning {
            background: linear-gradient(135deg, var(--warning-color), #d97706);
        }

        .stat-card.info {
            background: linear-gradient(135deg, var(--info-color), #0891b2);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        .stat-icon {
            font-size: 2.5rem;
            opacity: 0.3;
            position: absolute;
            top: 1rem;
            right: 1rem;
        }

        /* 功能按鈕 */
        .action-btn {
            background: white;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            padding: 1rem;
            border-radius: 0.75rem;
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
            transition: all 0.2s ease;
            min-height: 120px;
            justify-content: center;
        }

        .action-btn:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }

        .action-btn i {
            font-size: 2rem;
        }

        .action-btn span {
            font-weight: 600;
            font-size: 0.875rem;
        }

        /* 表格樣式 */
        .data-table {
            background: white;
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .table-header {
            background: var(--primary-color);
            color: white;
            padding: 1rem 1.5rem;
            font-weight: 600;
        }

        .table tbody tr:hover {
            background: #f8fafc;
        }

        /* 圖表容器 */
        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 1rem;
        }

        /* 響應式設計 */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .content-area {
                padding: 1rem;
            }

            .top-header {
                padding: 1rem;
            }
        }

        /* 載入動畫 */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f4f6;
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* 通知樣式 */
        .notification-item {
            padding: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .notification-item:hover {
            background: #f9fafb;
        }

        .notification-item.unread {
            background: #eff6ff;
            border-left: 3px solid var(--primary-color);
        }

        /* 隱藏/顯示內容區域 */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block !important;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 狀態指示器 */
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }

        .status-indicator.online {
            background: var(--success-color);
        }

        .status-indicator.offline {
            background: #6b7280;
        }

        .status-indicator.busy {
            background: var(--warning-color);
        }
    
        /* 員工系統完整功能模組樣式 */
        .content-section {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        
        /* 考勤系統樣式 */
        .info-card {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        /* 排班日曆樣式 */
        .schedule-calendar {
            background: white;
            border-radius: 10px;
            padding: 1rem;
        }
        
        .calendar-header {
            background: #f8f9fa;
            padding: 0.5rem 0;
            border-radius: 8px 8px 0 0;
        }
        
        .schedule-cell {
            border: 1px solid #dee2e6;
            min-height: 80px;
            padding: 0.5rem;
            text-align: center;
        }
        
        .schedule-cell.weekend {
            background: #fff3cd;
        }
        
        .shift-info {
            font-size: 0.8rem;
            color: #666;
        }
        
        .shift-legend {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        /* 績效分析樣式 */
        .performance-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1rem;
        }
        
        .progress-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .rating-stars {
            font-size: 1.2rem;
        }
        
        .rank-badge {
            font-size: 1.5rem;
        }
        
        .improvement-suggestions .suggestion-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        /* 獎金查詢樣式 */
        .commission-card {
            text-align: center;
            padding: 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
        }
        
        .commission-amount {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .commission-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        /* 個人資料樣式 */
        .profile-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .profile-avatar img {
            width: 120px;
            height: 120px;
            object-fit: cover;
        }
        
        .profile-badges {
            margin-top: 1rem;
        }
        
        .profile-field {
            background: #f8f9fa;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }
        
        .contact-info .contact-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
        }
        
        /* 薪資查詢樣式 */
        .salary-card {
            text-align: center;
            padding: 1.5rem;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border-radius: 12px;
        }
        
        .salary-amount {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .salary-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        /* 訓練課程樣式 */
        .training-stat {
            text-align: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .training-stat h3 {
            color: #007bff;
            margin-bottom: 0.5rem;
        }
        
        .training-course {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .course-progress .progress {
            height: 6px;
            margin: 0.5rem 0;
        }
        
        /* 報表樣式 */
        .report-filters {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
        }
        
        .report-chart {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }
        
        /* 通知中心樣式 */
        .notification-item {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid #eee;
        }
        
        .notification-item.unread {
            background: #f0f8ff;
            border-left: 4px solid #007bff;
        }
        
        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-content h6 {
            margin-bottom: 0.25rem;
        }
        
        .notification-content p {
            margin-bottom: 0.25rem;
            color: #666;
            font-size: 0.9rem;
        }
        
        /* 設定頁面樣式 */
        .setting-group {
            margin-bottom: 2rem;
        }
        
        .setting-group h5 {
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e9ecef;
        }
        
        .setting-item {
            margin-bottom: 1rem;
        }
        
        /* 動畫效果 */
        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        
        /* 響應式設計 */
        @media (max-width: 768px) {
            .commission-card,
            .salary-card,
            .performance-card {
                margin-bottom: 1rem;
            }
            
            .profile-avatar img {
                width: 80px;
                height: 80px;
            }
            
            .notification-item {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
        </style>
</head>
<body>
    <!-- 側邊欄 -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2><i class="bi bi-building"></i> 企業系統</h2>
            <div class="user-info">
                <span class="status-indicator online"></span>
                <span id="userName">載入中...</span>
            </div>
        </div>
        
        <nav class="sidebar-nav">
            <div class="nav-category">主要功能</div>
            <a href="#" class="nav-link active" data-section="dashboard">
                <i class="bi bi-speedometer2"></i>
                工作台概覽
            </a>
            
            <div class="nav-category">考勤管理</div>
            <a href="#" class="nav-link" data-section="attendance">
                <i class="bi bi-clock"></i>
                打卡考勤
            </a>
            <a href="#" class="nav-link" data-section="schedule">
                <i class="bi bi-calendar3"></i>
                班表查詢
            </a>
            <a href="#" class="nav-link" data-section="leave">
                <i class="bi bi-calendar-x"></i>
                請假申請
            </a>
            
            <div class="nav-category">營收管理</div>
            <a href="#" class="nav-link" data-section="revenue">
                <i class="bi bi-graph-up"></i>
                營收記錄
            </a>
            <a href="#" class="nav-link" data-section="performance">
                <i class="bi bi-trophy"></i>
                業績分析
            </a>
            <a href="#" class="nav-link" data-section="commission">
                <i class="bi bi-currency-dollar"></i>
                獎金查詢
            </a>
            
            <div class="nav-category">個人管理</div>
            <a href="#" class="nav-link" data-section="profile">
                <i class="bi bi-person"></i>
                個人資料
            </a>
            <a href="#" class="nav-link" data-section="salary">
                <i class="bi bi-wallet2"></i>
                薪資查詢
            </a>
            <a href="#" class="nav-link" data-section="training">
                <i class="bi bi-mortarboard"></i>
                教育訓練
            </a>
            
            <div class="nav-category">報表分析</div>
            <a href="#" class="nav-link" data-section="reports">
                <i class="bi bi-file-earmark-bar-graph"></i>
                數據報表
            </a>
            <a href="#" class="nav-link" data-section="analytics">
                <i class="bi bi-pie-chart"></i>
                分析中心
            </a>
            
            <div class="nav-category">系統</div>
            <a href="#" class="nav-link" data-section="notifications">
                <i class="bi bi-bell"></i>
                通知中心
            </a>
            <a href="#" class="nav-link" data-section="settings">
                <i class="bi bi-gear"></i>
                系統設定
            </a>
            <a href="#" class="nav-link" onclick="logout()">
                <i class="bi bi-box-arrow-right"></i>
                登出系統
            </a>
        </nav>
    </div>

    <!-- 主內容區域 -->
    <div class="main-content" id="mainContent">
        <!-- 頂部標題欄 -->
        <div class="top-header">
            <div class="header-left">
                <button class="menu-toggle" id="menuToggle">
                    <i class="bi bi-list"></i>
                </button>
                <h1 class="page-title" id="pageTitle">工作台概覽</h1>
            </div>
            <div class="header-right">
                <button class="notification-btn" id="notificationBtn">
                    <i class="bi bi-bell"></i>
                    <span class="notification-badge" id="notificationBadge">3</span>
                </button>
                <button class="user-menu-btn" id="userMenuBtn">
                    <i class="bi bi-person-circle"></i>
                </button>
            </div>
        </div>

        <!-- 內容區域 -->
        <div class="content-area">
            <!-- 工作台概覽 -->
            <div class="content-section active" id="dashboard">
                <div class="row g-4">
                    <!-- 統計卡片 -->
                    <div class="col-md-3">
                        <div class="dashboard-card stat-card position-relative">
                            <div class="stat-number" id="todayAttendance">8.5</div>
                            <div class="stat-label">今日工時 (小時)</div>
                            <i class="bi bi-clock stat-icon"></i>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="dashboard-card stat-card success position-relative">
                            <div class="stat-number" id="monthRevenue">125,000</div>
                            <div class="stat-label">本月營收 (元)</div>
                            <i class="bi bi-graph-up stat-icon"></i>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="dashboard-card stat-card warning position-relative">
                            <div class="stat-number" id="leaveBalance">15</div>
                            <div class="stat-label">特休餘額 (天)</div>
                            <i class="bi bi-calendar-check stat-icon"></i>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="dashboard-card stat-card info position-relative">
                            <div class="stat-number" id="performanceScore">92%</div>
                            <div class="stat-label">績效達成率</div>
                            <i class="bi bi-trophy stat-icon"></i>
                        </div>
                    </div>
                </div>

                <div class="row g-4 mt-4">
                    <!-- 快速功能 -->
                    <div class="col-md-8">
                        <div class="dashboard-card">
                            <h5 class="mb-4"><i class="bi bi-lightning"></i> 快速功能</h5>
                            <div class="row g-3">
                                <div class="col-md-3 col-6">
                                    <a href="#" class="action-btn" onclick="showSection('attendance')">
                                        <i class="bi bi-clock"></i>
                                        <span>上下班打卡</span>
                                    </a>
                                </div>
                                <div class="col-md-3 col-6">
                                    <a href="#" class="action-btn" onclick="showSection('revenue')">
                                        <i class="bi bi-plus-circle"></i>
                                        <span>新增營收</span>
                                    </a>
                                </div>
                                <div class="col-md-3 col-6">
                                    <a href="#" class="action-btn" onclick="showSection('leave')">
                                        <i class="bi bi-calendar-x"></i>
                                        <span>請假申請</span>
                                    </a>
                                </div>
                                <div class="col-md-3 col-6">
                                    <a href="#" class="action-btn" onclick="showSection('reports')">
                                        <i class="bi bi-file-earmark-text"></i>
                                        <span>查看報表</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 今日待辦 -->
                    <div class="col-md-4">
                        <div class="dashboard-card">
                            <h5 class="mb-4"><i class="bi bi-check2-square"></i> 今日待辦</h5>
                            <div id="todoList">
                                <div class="notification-item">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span>完成月度營收報表</span>
                                        <small class="text-muted">今天</small>
                                    </div>
                                </div>
                                <div class="notification-item unread">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span>參加團隊會議</span>
                                        <small class="text-muted">14:00</small>
                                    </div>
                                </div>
                                <div class="notification-item">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span>提交考勤異常說明</span>
                                        <small class="text-muted">明天</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row g-4 mt-4">
                    <!-- 近期考勤 -->
                    <div class="col-md-6">
                        <div class="data-table">
                            <div class="table-header">
                                <i class="bi bi-clock-history"></i> 近期考勤記錄
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>日期</th>
                                            <th>上班</th>
                                            <th>下班</th>
                                            <th>狀態</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recentAttendance">
                                        <tr>
                                            <td>今天</td>
                                            <td>08:30</td>
                                            <td>-</td>
                                            <td><span class="badge bg-success">進行中</span></td>
                                        </tr>
                                        <tr>
                                            <td>昨天</td>
                                            <td>08:25</td>
                                            <td>17:30</td>
                                            <td><span class="badge bg-success">正常</span></td>
                                        </tr>
                                        <tr>
                                            <td>08/10</td>
                                            <td>08:35</td>
                                            <td>17:25</td>
                                            <td><span class="badge bg-warning">遲到</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 營收趨勢 -->
                    <div class="col-md-6">
                        <div class="dashboard-card">
                            <h5 class="mb-3"><i class="bi bi-graph-up"></i> 營收趨勢</h5>
                            <div class="chart-container">
                                <canvas id="revenueChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            
            <div class="content-section" id="schedule" style="display: none;">
                <div class="dashboard-card">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4><i class="bi bi-calendar3"></i> 班表查詢</h4>
                        <div>
                            <select class="form-select" id="scheduleMonth" onchange="loadSchedule()">
                                <option value="2025-08">2025年8月</option>
                                <option value="2025-09">2025年9月</option>
                                <option value="2025-10">2025年10月</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="schedule-calendar">
                        <div class="calendar-header">
                            <div class="row text-center">
                                <div class="col">週一</div>
                                <div class="col">週二</div>
                                <div class="col">週三</div>
                                <div class="col">週四</div>
                                <div class="col">週五</div>
                                <div class="col text-danger">週六</div>
                                <div class="col text-danger">週日</div>
                            </div>
                        </div>
                        <div class="calendar-body" id="scheduleCalendar">
                            <div class="row">
                                <div class="col schedule-cell">
                                    <div class="date">1</div>
                                    <div class="shift-info">早班<br>08:00-16:00</div>
                                </div>
                                <div class="col schedule-cell">
                                    <div class="date">2</div>
                                    <div class="shift-info">早班<br>08:00-16:00</div>
                                </div>
                                <div class="col schedule-cell">
                                    <div class="date">3</div>
                                    <div class="shift-info">休息</div>
                                </div>
                                <div class="col schedule-cell">
                                    <div class="date">4</div>
                                    <div class="shift-info">晚班<br>16:00-24:00</div>
                                </div>
                                <div class="col schedule-cell">
                                    <div class="date">5</div>
                                    <div class="shift-info">早班<br>08:00-16:00</div>
                                </div>
                                <div class="col schedule-cell weekend">
                                    <div class="date">6</div>
                                    <div class="shift-info">休息</div>
                                </div>
                                <div class="col schedule-cell weekend">
                                    <div class="date">7</div>
                                    <div class="shift-info">休息</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <h5>班別說明</h5>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <div class="shift-legend">
                                    <span class="badge bg-success">早班</span>
                                    <span>08:00 - 16:00</span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="shift-legend">
                                    <span class="badge bg-warning">晚班</span>
                                    <span>16:00 - 24:00</span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="shift-legend">
                                    <span class="badge bg-secondary">休息</span>
                                    <span>休假日</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            
            <div class="content-section" id="leave" style="display: none;">
                <div class="dashboard-card">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4><i class="bi bi-calendar-x"></i> 請假申請</h4>
                        <button class="btn btn-primary" onclick="showLeaveModal()">
                            <i class="bi bi-plus-circle"></i> 新增請假申請
                        </button>
                    </div>

                    <div class="row g-4 mb-4">
                        <div class="col-md-3">
                            <div class="info-card text-center">
                                <h3 class="text-success">15</h3>
                                <p class="mb-0">剩餘特休</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="info-card text-center">
                                <h3 class="text-info">30</h3>
                                <p class="mb-0">剩餘病假</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="info-card text-center">
                                <h3 class="text-warning">5</h3>
                                <p class="mb-0">已請天數</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="info-card text-center">
                                <h3 class="text-secondary">2</h3>
                                <p class="mb-0">待審核</p>
                            </div>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>申請日期</th>
                                    <th>請假類型</th>
                                    <th>開始日期</th>
                                    <th>結束日期</th>
                                    <th>天數</th>
                                    <th>原因</th>
                                    <th>狀態</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>2025-08-10</td>
                                    <td><span class="badge bg-success">特休</span></td>
                                    <td>2025-08-15</td>
                                    <td>2025-08-16</td>
                                    <td>2天</td>
                                    <td>個人事務</td>
                                    <td><span class="badge bg-warning">審核中</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary" onclick="viewLeave(1)">查看</button>
                                        <button class="btn btn-sm btn-outline-danger" onclick="cancelLeave(1)">撤回</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>2025-08-05</td>
                                    <td><span class="badge bg-info">病假</span></td>
                                    <td>2025-08-08</td>
                                    <td>2025-08-08</td>
                                    <td>1天</td>
                                    <td>感冒就醫</td>
                                    <td><span class="badge bg-success">已核准</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary" onclick="viewLeave(2)">查看</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            
            <div class="content-section" id="performance" style="display: none;">
                <div class="dashboard-card">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4><i class="bi bi-graph-up-arrow"></i> 業績分析</h4>
                        <div class="btn-group">
                            <button class="btn btn-outline-primary active" onclick="showPerformancePeriod('month')">月度</button>
                            <button class="btn btn-outline-primary" onclick="showPerformancePeriod('quarter')">季度</button>
                            <button class="btn btn-outline-primary" onclick="showPerformancePeriod('year')">年度</button>
                        </div>
                    </div>

                    <div class="row g-4 mb-4">
                        <div class="col-md-4">
                            <div class="performance-card">
                                <div class="performance-header">
                                    <h5>銷售目標達成率</h5>
                                    <div class="progress-circle">
                                        <span class="percentage">92%</span>
                                    </div>
                                </div>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar bg-success" style="width: 92%"></div>
                                </div>
                                <small class="text-muted">目標: $130,000 | 實際: $125,000</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="performance-card">
                                <div class="performance-header">
                                    <h5>客戶服務評分</h5>
                                    <div class="rating-stars">
                                        <i class="bi bi-star-fill text-warning"></i>
                                        <i class="bi bi-star-fill text-warning"></i>
                                        <i class="bi bi-star-fill text-warning"></i>
                                        <i class="bi bi-star-fill text-warning"></i>
                                        <i class="bi bi-star-fill text-warning"></i>
                                        <span class="ms-2">4.8/5.0</span>
                                    </div>
                                </div>
                                <p class="mb-0">基於156位客戶評價</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="performance-card">
                                <div class="performance-header">
                                    <h5>部門排名</h5>
                                    <div class="rank-badge">
                                        <span class="badge bg-warning">第2名</span>
                                    </div>
                                </div>
                                <p class="mb-0">在8位同事中排名第2</p>
                                <small class="text-success">較上月提升1名</small>
                            </div>
                        </div>
                    </div>

                    <div class="row g-4">
                        <div class="col-md-6">
                            <h5>月度業績趨勢</h5>
                            <canvas id="performanceTrendChart"></canvas>
                        </div>
                        <div class="col-md-6">
                            <h5>技能評估雷達圖</h5>
                            <canvas id="skillRadarChart"></canvas>
                        </div>
                    </div>

                    <div class="mt-4">
                        <h5>改進建議</h5>
                        <div class="improvement-suggestions">
                            <div class="suggestion-item">
                                <i class="bi bi-lightbulb text-warning"></i>
                                <div>
                                    <strong>銷售技巧</strong>
                                    <p class="mb-0">建議參加高級銷售技巧培訓，提升成交率</p>
                                </div>
                            </div>
                            <div class="suggestion-item">
                                <i class="bi bi-people text-success"></i>
                                <div>
                                    <strong>客戶關係</strong>
                                    <p class="mb-0">繼續保持優秀的客戶服務水準</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            
            <div class="content-section" id="commission" style="display: none;">
                <div class="dashboard-card">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4><i class="bi bi-currency-exchange"></i> 獎金查詢</h4>
                        <button class="btn btn-outline-primary" onclick="downloadCommissionReport()">
                            <i class="bi bi-download"></i> 下載報表
                        </button>
                    </div>

                    <div class="row g-4 mb-4">
                        <div class="col-md-3">
                            <div class="commission-card">
                                <div class="commission-amount">$8,500</div>
                                <div class="commission-label">本月預估獎金</div>
                                <small class="text-success">+15% vs 上月</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="commission-card">
                                <div class="commission-amount">$7,200</div>
                                <div class="commission-label">上月實際獎金</div>
                                <small class="text-info">已發放</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="commission-card">
                                <div class="commission-amount">$45,600</div>
                                <div class="commission-label">今年累計獎金</div>
                                <small class="text-primary">8個月</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="commission-card">
                                <div class="commission-amount">6.8%</div>
                                <div class="commission-label">平均獎金率</div>
                                <small class="text-warning">vs 營收</small>
                            </div>
                        </div>
                    </div>

                    <div class="commission-breakdown mb-4">
                        <h5>本月獎金明細</h5>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>項目</th>
                                        <th>基數</th>
                                        <th>比率</th>
                                        <th>金額</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>銷售業績獎金</td>
                                        <td>$125,000</td>
                                        <td>5.0%</td>
                                        <td class="text-success">$6,250</td>
                                    </tr>
                                    <tr>
                                        <td>客戶滿意度獎金</td>
                                        <td>4.8分</td>
                                        <td>$400/分</td>
                                        <td class="text-success">$1,920</td>
                                    </tr>
                                    <tr>
                                        <td>團隊合作獎金</td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td class="text-success">$330</td>
                                    </tr>
                                    <tr class="table-info">
                                        <td><strong>預估總計</strong></td>
                                        <td>-</td>
                                        <td>-</td>
                                        <td class="text-success"><strong>$8,500</strong></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="row g-4">
                        <div class="col-md-8">
                            <h5>獎金趨勢圖</h5>
                            <canvas id="commissionChart"></canvas>
                        </div>
                        <div class="col-md-4">
                            <h5>獎金組成</h5>
                            <canvas id="commissionPieChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            
            <div class="content-section" id="profile" style="display: none;">
                <div class="dashboard-card">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4><i class="bi bi-person-circle"></i> 個人資料</h4>
                        <button class="btn btn-primary" onclick="editProfile()">
                            <i class="bi bi-pencil"></i> 編輯資料
                        </button>
                    </div>

                    <div class="row g-4">
                        <div class="col-md-4">
                            <div class="profile-card text-center">
                                <div class="profile-avatar">
                                    <img src="https://via.placeholder.com/150" alt="員工照片" class="rounded-circle">
                                </div>
                                <h5 class="mt-3">張小明</h5>
                                <p class="text-muted">資深銷售專員</p>
                                <div class="profile-badges">
                                    <span class="badge bg-success">在職</span>
                                    <span class="badge bg-info">正式員工</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="profile-details">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label">員工編號</label>
                                        <div class="profile-field">EMP001</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">部門</label>
                                        <div class="profile-field">銷售部</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">職位</label>
                                        <div class="profile-field">資深銷售專員</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">直屬主管</label>
                                        <div class="profile-field">李店長</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">到職日期</label>
                                        <div class="profile-field">2022-03-15</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">員工狀態</label>
                                        <div class="profile-field">
                                            <span class="badge bg-success">在職</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr class="my-4">

                    <div class="row g-4">
                        <div class="col-md-6">
                            <h5>聯絡資訊</h5>
                            <div class="contact-info">
                                <div class="contact-item">
                                    <i class="bi bi-telephone"></i>
                                    <span>0912-345-678</span>
                                </div>
                                <div class="contact-item">
                                    <i class="bi bi-envelope"></i>
                                    <span>zhang.xiaoming@company.com</span>
                                </div>
                                <div class="contact-item">
                                    <i class="bi bi-house"></i>
                                    <span>台北市信義區信義路100號</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h5>緊急聯絡人</h5>
                            <div class="emergency-contact">
                                <p><strong>姓名:</strong> 張太太</p>
                                <p><strong>關係:</strong> 配偶</p>
                                <p><strong>電話:</strong> 0987-654-321</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            
            <div class="content-section" id="salary" style="display: none;">
                <div class="dashboard-card">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4><i class="bi bi-cash-stack"></i> 薪資查詢</h4>
                        <div>
                            <select class="form-select" id="salaryMonth" onchange="loadSalary()">
                                <option value="2025-08">2025年8月</option>
                                <option value="2025-07">2025年7月</option>
                                <option value="2025-06">2025年6月</option>
                            </select>
                        </div>
                    </div>

                    <div class="salary-summary mb-4">
                        <div class="row g-4">
                            <div class="col-md-3">
                                <div class="salary-card">
                                    <div class="salary-amount">$65,000</div>
                                    <div class="salary-label">本月實領</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="salary-card">
                                    <div class="salary-amount">$50,000</div>
                                    <div class="salary-label">基本薪資</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="salary-card">
                                    <div class="salary-amount">$8,500</div>
                                    <div class="salary-label">績效獎金</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="salary-card">
                                    <div class="salary-amount">$2,000</div>
                                    <div class="salary-label">加班費</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row g-4">
                        <div class="col-md-6">
                            <div class="salary-breakdown">
                                <h5>薪資明細</h5>
                                <table class="table">
                                    <tbody>
                                        <tr>
                                            <td>基本薪資</td>
                                            <td class="text-end text-success">+$50,000</td>
                                        </tr>
                                        <tr>
                                            <td>績效獎金</td>
                                            <td class="text-end text-success">+$8,500</td>
                                        </tr>
                                        <tr>
                                            <td>加班費</td>
                                            <td class="text-end text-success">+$2,000</td>
                                        </tr>
                                        <tr>
                                            <td>津貼補助</td>
                                            <td class="text-end text-success">+$3,000</td>
                                        </tr>
                                        <tr class="table-warning">
                                            <td><strong>應發合計</strong></td>
                                            <td class="text-end"><strong>$63,500</strong></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="deduction-breakdown">
                                <h5>扣款明細</h5>
                                <table class="table">
                                    <tbody>
                                        <tr>
                                            <td>勞工保險</td>
                                            <td class="text-end text-danger">-$1,200</td>
                                        </tr>
                                        <tr>
                                            <td>健康保險</td>
                                            <td class="text-end text-danger">-$800</td>
                                        </tr>
                                        <tr>
                                            <td>所得稅</td>
                                            <td class="text-end text-danger">-$2,500</td>
                                        </tr>
                                        <tr>
                                            <td>勞退提撥</td>
                                            <td class="text-end text-danger">-$1,000</td>
                                        </tr>
                                        <tr class="table-danger">
                                            <td><strong>扣款合計</strong></td>
                                            <td class="text-end"><strong>-$5,500</strong></td>
                                        </tr>
                                        <tr class="table-success">
                                            <td><strong>實際實領</strong></td>
                                            <td class="text-end"><strong>$58,000</strong></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <h5>薪資趨勢</h5>
                        <canvas id="salaryChart"></canvas>
                    </div>
                </div>
            </div>

            
            <div class="content-section" id="training" style="display: none;">
                <div class="dashboard-card">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4><i class="bi bi-mortarboard"></i> 教育訓練</h4>
                        <button class="btn btn-primary" onclick="enrollTraining()">
                            <i class="bi bi-plus-circle"></i> 報名課程
                        </button>
                    </div>

                    <div class="row g-4 mb-4">
                        <div class="col-md-3">
                            <div class="training-stat">
                                <h3>12</h3>
                                <p>已完成課程</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="training-stat">
                                <h3>3</h3>
                                <p>進行中課程</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="training-stat">
                                <h3>45</h3>
                                <p>總學習時數</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="training-stat">
                                <h3>85%</h3>
                                <p>平均成績</p>
                            </div>
                        </div>
                    </div>

                    <div class="training-tabs mb-4">
                        <ul class="nav nav-tabs">
                            <li class="nav-item">
                                <a class="nav-link active" href="#ongoing" data-bs-toggle="tab">進行中</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#available" data-bs-toggle="tab">可報名</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#completed" data-bs-toggle="tab">已完成</a>
                            </li>
                        </ul>
                        <div class="tab-content mt-3">
                            <div class="tab-pane active" id="ongoing">
                                <div class="training-course">
                                    <div class="course-info">
                                        <h5>高級銷售技巧培訓</h5>
                                        <p>提升銷售能力和客戶溝通技巧</p>
                                        <div class="course-progress">
                                            <div class="progress">
                                                <div class="progress-bar" style="width: 65%">65%</div>
                                            </div>
                                            <small class="text-muted">預計完成: 2025-08-20</small>
                                        </div>
                                    </div>
                                    <button class="btn btn-outline-primary">繼續學習</button>
                                </div>
                            </div>
                            <div class="tab-pane" id="available">
                                <div class="training-course">
                                    <div class="course-info">
                                        <h5>數位行銷基礎</h5>
                                        <p>學習現代數位行銷策略和工具</p>
                                        <small class="text-muted">開課日期: 2025-09-01</small>
                                    </div>
                                    <button class="btn btn-primary">立即報名</button>
                                </div>
                            </div>
                            <div class="tab-pane" id="completed">
                                <div class="training-course">
                                    <div class="course-info">
                                        <h5>客戶服務優化</h5>
                                        <p>提升客戶滿意度的服務技巧</p>
                                        <div class="course-score">
                                            <span class="badge bg-success">已完成 - 92分</span>
                                        </div>
                                    </div>
                                    <button class="btn btn-outline-secondary">查看證書</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            
            <div class="content-section" id="reports" style="display: none;">
                <div class="dashboard-card">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4><i class="bi bi-bar-chart"></i> 數據報表</h4>
                        <div class="btn-group">
                            <button class="btn btn-outline-primary" onclick="exportReport('pdf')">
                                <i class="bi bi-file-pdf"></i> PDF
                            </button>
                            <button class="btn btn-outline-success" onclick="exportReport('excel')">
                                <i class="bi bi-file-excel"></i> Excel
                            </button>
                        </div>
                    </div>

                    <div class="report-filters mb-4">
                        <div class="row g-3">
                            <div class="col-md-3">
                                <select class="form-select" id="reportType">
                                    <option value="performance">個人績效報表</option>
                                    <option value="attendance">出勤統計報表</option>
                                    <option value="commission">獎金統計報表</option>
                                    <option value="training">培訓進度報表</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <input type="date" class="form-control" id="reportStartDate" value="2025-08-01">
                            </div>
                            <div class="col-md-3">
                                <input type="date" class="form-control" id="reportEndDate" value="2025-08-31">
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-primary" onclick="generateReport()">
                                    <i class="bi bi-search"></i> 生成報表
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="row g-4">
                        <div class="col-md-6">
                            <div class="report-chart">
                                <h5>績效趨勢圖</h5>
                                <canvas id="performanceReportChart"></canvas>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="report-summary">
                                <h5>統計摘要</h5>
                                <div class="summary-item">
                                    <span>平均績效分數</span>
                                    <strong>85分</strong>
                                </div>
                                <div class="summary-item">
                                    <span>出勤率</span>
                                    <strong>96%</strong>
                                </div>
                                <div class="summary-item">
                                    <span>目標達成率</span>
                                    <strong>92%</strong>
                                </div>
                                <div class="summary-item">
                                    <span>客戶滿意度</span>
                                    <strong>4.8/5.0</strong>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <h5>詳細數據</h5>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>日期</th>
                                        <th>銷售額</th>
                                        <th>客戶數</th>
                                        <th>平均客單價</th>
                                        <th>滿意度</th>
                                        <th>達成率</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>2025-08-01</td>
                                        <td>$4,200</td>
                                        <td>12</td>
                                        <td>$350</td>
                                        <td>4.9</td>
                                        <td>95%</td>
                                    </tr>
                                    <tr>
                                        <td>2025-08-02</td>
                                        <td>$3,800</td>
                                        <td>10</td>
                                        <td>$380</td>
                                        <td>4.7</td>
                                        <td>88%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            
            <div class="content-section" id="analytics" style="display: none;">
                <div class="dashboard-card">
                    <h4><i class="bi bi-graph-up"></i> 分析中心</h4>
                    <div class="analytics-dashboard">
                        <div class="row g-4">
                            <div class="col-md-8">
                                <div class="analytics-chart">
                                    <h5>綜合分析儀表板</h5>
                                    <canvas id="analyticsChart"></canvas>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="analytics-insights">
                                    <h5>智慧洞察</h5>
                                    <div class="insight-item">
                                        <i class="bi bi-lightbulb text-warning"></i>
                                        <p>您的銷售額在週三通常最高，建議在該日安排重要客戶會議</p>
                                    </div>
                                    <div class="insight-item">
                                        <i class="bi bi-graph-up text-success"></i>
                                        <p>較上月同期，您的客戶滿意度提升了0.3分</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            
            <div class="content-section" id="notifications" style="display: none;">
                <div class="dashboard-card">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4><i class="bi bi-bell"></i> 通知中心</h4>
                        <button class="btn btn-outline-secondary" onclick="markAllAsRead()">
                            <i class="bi bi-check-all"></i> 全部標為已讀
                        </button>
                    </div>

                    <div class="notification-filters mb-3">
                        <div class="btn-group">
                            <button class="btn btn-outline-primary active" onclick="filterNotifications('all')">全部</button>
                            <button class="btn btn-outline-primary" onclick="filterNotifications('unread')">未讀</button>
                            <button class="btn btn-outline-primary" onclick="filterNotifications('important')">重要</button>
                        </div>
                    </div>

                    <div class="notifications-list">
                        <div class="notification-item unread">
                            <div class="notification-icon bg-primary">
                                <i class="bi bi-info-circle"></i>
                            </div>
                            <div class="notification-content">
                                <h6>新的培訓課程開放報名</h6>
                                <p>「數位行銷基礎」課程現在開放報名，截止日期為8月25日</p>
                                <small class="text-muted">2小時前</small>
                            </div>
                            <div class="notification-actions">
                                <button class="btn btn-sm btn-outline-primary" onclick="markAsRead(1)">標為已讀</button>
                            </div>
                        </div>

                        <div class="notification-item">
                            <div class="notification-icon bg-success">
                                <i class="bi bi-check-circle"></i>
                            </div>
                            <div class="notification-content">
                                <h6>請假申請已核准</h6>
                                <p>您提交的8月15-16日特休申請已經核准</p>
                                <small class="text-muted">1天前</small>
                            </div>
                        </div>

                        <div class="notification-item">
                            <div class="notification-icon bg-warning">
                                <i class="bi bi-exclamation-triangle"></i>
                            </div>
                            <div class="notification-content">
                                <h6>考勤異常提醒</h6>
                                <p>8月10日出勤記錄顯示遲到，如有異議請及時申請修正</p>
                                <small class="text-muted">2天前</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            
            <div class="content-section" id="settings" style="display: none;">
                <div class="dashboard-card">
                    <h4><i class="bi bi-gear"></i> 系統設定</h4>
                    
                    <div class="settings-tabs">
                        <ul class="nav nav-tabs mb-4">
                            <li class="nav-item">
                                <a class="nav-link active" href="#personal-settings" data-bs-toggle="tab">個人設定</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#notification-settings" data-bs-toggle="tab">通知設定</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#privacy-settings" data-bs-toggle="tab">隱私設定</a>
                            </li>
                        </ul>

                        <div class="tab-content">
                            <div class="tab-pane active" id="personal-settings">
                                <div class="setting-group">
                                    <h5>顯示設定</h5>
                                    <div class="setting-item">
                                        <label class="form-label">主題色彩</label>
                                        <select class="form-select">
                                            <option>藍色主題</option>
                                            <option>綠色主題</option>
                                            <option>深色主題</option>
                                        </select>
                                    </div>
                                    <div class="setting-item">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="darkMode">
                                            <label class="form-check-label" for="darkMode">深色模式</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="tab-pane" id="notification-settings">
                                <div class="setting-group">
                                    <h5>通知偏好</h5>
                                    <div class="setting-item">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="emailNotifications" checked>
                                            <label class="form-check-label" for="emailNotifications">Email通知</label>
                                        </div>
                                    </div>
                                    <div class="setting-item">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="pushNotifications" checked>
                                            <label class="form-check-label" for="pushNotifications">推播通知</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="tab-pane" id="privacy-settings">
                                <div class="setting-group">
                                    <h5>隱私控制</h5>
                                    <div class="setting-item">
                                        <label class="form-label">資料可見性</label>
                                        <select class="form-select">
                                            <option>僅限主管查看</option>
                                            <option>團隊成員可見</option>
                                            <option>完全保密</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <button class="btn btn-primary" onclick="saveSettings()">保存設定</button>
                        <button class="btn btn-outline-secondary" onclick="resetSettings()">重置為預設</button>
                    </div>
                </div>
            </div>

            <!-- 其他內容區域將在接下來實現 -->
            
            <div class="content-section" id="attendance" style="display: none;">
                <div class="dashboard-card">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4><i class="bi bi-clock-history"></i> 打卡考勤系統</h4>
                        <div class="btn-group">
                            <button class="btn btn-success" onclick="clockIn()">
                                <i class="bi bi-box-arrow-in-right"></i> 上班打卡
                            </button>
                            <button class="btn btn-danger" onclick="clockOut()">
                                <i class="bi bi-box-arrow-right"></i> 下班打卡
                            </button>
                        </div>
                    </div>
                    
                    <div class="row g-4">
                        <div class="col-md-4">
                            <div class="info-card">
                                <h6>今日狀態</h6>
                                <div id="todayStatus" class="mt-2">
                                    <span class="badge bg-success">已打卡</span>
                                    <p class="mb-0 mt-1">上班時間: 08:30</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="info-card">
                                <h6>本月統計</h6>
                                <div class="mt-2">
                                    <p class="mb-1">出勤天數: <strong>22天</strong></p>
                                    <p class="mb-0">遲到次數: <strong>1次</strong></p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="info-card">
                                <h6>GPS定位</h6>
                                <div id="gpsStatus" class="mt-2">
                                    <span class="badge bg-info">定位中...</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <h5>考勤記錄</h5>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>日期</th>
                                        <th>上班時間</th>
                                        <th>下班時間</th>
                                        <th>工作時數</th>
                                        <th>狀態</th>
                                    </tr>
                                </thead>
                                <tbody id="attendanceRecords">
                                    <tr>
                                        <td>2025-08-12</td>
                                        <td>08:30</td>
                                        <td>進行中</td>
                                        <td>-</td>
                                        <td><span class="badge bg-success">正常</span></td>
                                    </tr>
                                    <tr>
                                        <td>2025-08-11</td>
                                        <td>08:25</td>
                                        <td>17:30</td>
                                        <td>9.0小時</td>
                                        <td><span class="badge bg-success">正常</span></td>
                                    </tr>
                                    <tr>
                                        <td>2025-08-10</td>
                                        <td>08:35</td>
                                        <td>17:25</td>
                                        <td>8.8小時</td>
                                        <td><span class="badge bg-warning">遲到</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            
            <div class="content-section" id="revenue" style="display: none;">
                <div class="dashboard-card">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4><i class="bi bi-graph-up"></i> 營收記錄</h4>
                        <div class="d-flex gap-2 align-items-center">
                            <select class="form-select" id="revenueMonth" onchange="loadRevenue()">
                                <option value="2025-08">2025年8月</option>
                                <option value="2025-07">2025年7月</option>
                                <option value="2025-06">2025年6月</option>
                            </select>
                            <button class="btn btn-primary" onclick="generateRevenueReport()">
                                <i class="bi bi-file-text"></i> 生成報表
                            </button>
                        </div>
                    </div>

                    <div class="row g-4 mb-4">
                        <div class="col-md-3">
                            <div class="stat-card">
                                <div class="stat-icon bg-success">
                                    <i class="bi bi-currency-dollar"></i>
                                </div>
                                <div class="stat-info">
                                    <h3>$125,000</h3>
                                    <p class="mb-0">本月營收</p>
                                    <small class="text-success">+12% vs 上月</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card">
                                <div class="stat-icon bg-info">
                                    <i class="bi bi-receipt"></i>
                                </div>
                                <div class="stat-info">
                                    <h3>342</h3>
                                    <p class="mb-0">交易筆數</p>
                                    <small class="text-info">+8% vs 上月</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card">
                                <div class="stat-icon bg-warning">
                                    <i class="bi bi-graph-down"></i>
                                </div>
                                <div class="stat-info">
                                    <h3>$365</h3>
                                    <p class="mb-0">平均客單價</p>
                                    <small class="text-warning">+3% vs 上月</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="stat-card">
                                <div class="stat-icon bg-primary">
                                    <i class="bi bi-people"></i>
                                </div>
                                <div class="stat-info">
                                    <h3>156</h3>
                                    <p class="mb-0">服務客戶數</p>
                                    <small class="text-primary">+15% vs 上月</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row g-4">
                        <div class="col-md-8">
                            <div class="chart-container">
                                <canvas id="revenueChart"></canvas>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <h5>最近交易</h5>
                            <div class="recent-transactions">
                                <div class="transaction-item">
                                    <div class="d-flex justify-content-between">
                                        <span>客戶 #1234</span>
                                        <strong>$450</strong>
                                    </div>
                                    <small class="text-muted">今天 14:30</small>
                                </div>
                                <div class="transaction-item">
                                    <div class="d-flex justify-content-between">
                                        <span>客戶 #1235</span>
                                        <strong>$280</strong>
                                    </div>
                                    <small class="text-muted">今天 13:15</small>
                                </div>
                                <div class="transaction-item">
                                    <div class="d-flex justify-content-between">
                                        <span>客戶 #1236</span>
                                        <strong>$320</strong>
                                    </div>
                                    <small class="text-muted">今天 11:45</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 更多內容區域... -->
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // 🔐 認證檢查系統
        (function() {
            'use strict';
            
            console.log('🔐 啟動企業員工系統認證檢查...');
            
            function checkAuthentication() {
                const token = localStorage.getItem('employeeToken');
                const employeeData = localStorage.getItem('employeeData');
                
                if (!token || !employeeData) {
                    console.log('❌ 認證失敗: 未找到有效的登入憑證');
                    window.location.href = '/login';
                    return false;
                }
                
                // 載入員工資料
                try {
                    const employee = JSON.parse(employeeData);
                    document.getElementById('userName').textContent = employee.name || '員工';
                } catch (error) {
                    console.error('員工資料解析失敗:', error);
                }
                
                console.log('✅ 認證成功: 企業員工系統已載入');
                return true;
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    setTimeout(checkAuthentication, 300);
                });
            } else {
                setTimeout(checkAuthentication, 300);
            }
        })();

        // 主要系統功能
        class EnterpriseEmployeeSystem {
            constructor() {
                this.currentSection = 'dashboard';
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.initializeCharts();
                this.loadDashboardData();
            }

            setupEventListeners() {
                // 側邊欄切換
                const menuToggle = document.getElementById('menuToggle');
                const sidebar = document.getElementById('sidebar');
                const mainContent = document.getElementById('mainContent');

                menuToggle.addEventListener('click', () => {
                    if (window.innerWidth <= 768) {
                        sidebar.classList.toggle('show');
                    } else {
                        sidebar.classList.toggle('collapsed');
                        mainContent.classList.toggle('expanded');
                    }
                });

                // 導航連結
                document.querySelectorAll('.nav-link[data-section]').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = e.target.closest('[data-section]').dataset.section;
                        this.showSection(section);
                    });
                });

                // 響應式處理
                window.addEventListener('resize', () => {
                    if (window.innerWidth > 768) {
                        sidebar.classList.remove('show');
                    }
                });
            }

            showSection(sectionName) {
                // 隱藏所有內容區域
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.remove('active');
                    section.style.display = 'none';
                });

                // 顯示目標區域
                const targetSection = document.getElementById(sectionName);
                if (targetSection) {
                    targetSection.classList.add('active');
                    targetSection.style.display = 'block';
                }

                // 更新導航狀態
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                
                const activeLink = document.querySelector(`[data-section="${sectionName}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                }

                // 更新頁面標題
                const titles = {
                    'dashboard': '工作台概覽',
                    'attendance': '打卡考勤',
                    'schedule': '班表查詢',
                    'leave': '請假申請',
                    'revenue': '營收記錄',
                    'performance': '業績分析',
                    'commission': '獎金查詢',
                    'profile': '個人資料',
                    'salary': '薪資查詢',
                    'training': '教育訓練',
                    'reports': '數據報表',
                    'analytics': '分析中心',
                    'notifications': '通知中心',
                    'settings': '系統設定'
                };

                document.getElementById('pageTitle').textContent = titles[sectionName] || '企業系統';
                this.currentSection = sectionName;

                // 根據功能區載入對應數據 - API集成
                this.loadSectionData(sectionName);

                // 在手機版本關閉側邊欄
                if (window.innerWidth <= 768) {
                    document.getElementById('sidebar').classList.remove('show');
                }
            }
            
            // 載入功能區數據
            async loadSectionData(sectionName) {
                try {
                    switch (sectionName) {
                        case 'revenue':
                            if (typeof loadRevenueData === 'function') {
                                await loadRevenueData();
                            }
                            break;
                        case 'schedule':
                            if (typeof loadScheduleData === 'function') {
                                await loadScheduleData();
                            }
                            break;
                        case 'attendance':
                            if (typeof loadAttendanceRecords === 'function') {
                                await loadAttendanceRecords();
                            }
                            break;
                        case 'analytics':
                        case 'voting':
                            if (typeof loadVotingData === 'function') {
                                await loadVotingData();
                            }
                            break;
                        default:
                            console.log(`功能區 ${sectionName} 無需特殊數據載入`);
                            break;
                    }
                } catch (error) {
                    console.error(`載入 ${sectionName} 數據失敗:`, error);
                }
            }

            initializeCharts() {
                // 營收趨勢圖表
                const ctx = document.getElementById('revenueChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月'],
                        datasets: [{
                            label: '營收金額',
                            data: [85000, 92000, 108000, 95000, 115000, 125000, 130000, 125000],
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return value.toLocaleString() + '元';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            loadDashboardData() {
                // 載入儀表板數據 (模擬 API 呼叫)
                setTimeout(() => {
                    this.updateStatistics();
                    this.loadRecentAttendance();
                }, 1000);
            }

            updateStatistics() {
                // 更新統計數據
                const stats = {
                    todayAttendance: '8.5',
                    monthRevenue: '125,000',
                    leaveBalance: '15',
                    performanceScore: '92%'
                };

                Object.keys(stats).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.textContent = stats[key];
                    }
                });
            }

            loadRecentAttendance() {
                // 載入近期考勤記錄
                const attendanceData = [
                    { date: '今天', in: '08:30', out: '-', status: '進行中', statusClass: 'success' },
                    { date: '昨天', in: '08:25', out: '17:30', status: '正常', statusClass: 'success' },
                    { date: '08/10', in: '08:35', out: '17:25', status: '遲到', statusClass: 'warning' },
                    { date: '08/09', in: '08:20', out: '17:35', status: '正常', statusClass: 'success' },
                    { date: '08/08', in: '08:45', out: '17:20', status: '遲到', statusClass: 'warning' }
                ];

                const tbody = document.getElementById('recentAttendance');
                if (tbody) {
                    tbody.innerHTML = attendanceData.map(record => `
                        <tr>
                            <td>${record.date}</td>
                            <td>${record.in}</td>
                            <td>${record.out}</td>
                            <td><span class="badge bg-${record.statusClass}">${record.status}</span></td>
                        </tr>
                    `).join('');
                }
            }
        }

        // 全域函數
        function showSection(sectionName) {
            if (window.employeeSystem) {
                window.employeeSystem.showSection(sectionName);
            }
        }

        function logout() {
            if (confirm('確定要登出系統嗎？')) {
                localStorage.removeItem('employeeToken');
                localStorage.removeItem('employeeData');
                window.location.href = '/login';
            }
        }

        // 初始化系統
        document.addEventListener('DOMContentLoaded', function() {
            window.employeeSystem = new EnterpriseEmployeeSystem();
        });

        
        // 完整員工系統功能JavaScript實現
        
        // GPS打卡功能 - 真實API集成
        async function clockIn() {
            if (!navigator.geolocation) {
                showNotification('您的瀏覽器不支援GPS定位', 'error');
                return;
            }

            try {
                showNotification('正在獲取GPS位置...', 'info');
                
                const position = await getCurrentPosition();
                const { latitude, longitude } = position.coords;
                
                console.log(`GPS位置獲取成功: ${latitude}, ${longitude}`);
                
                // 調用真實的打卡API
                const attendanceData = {
                    type: 'clock_in',
                    latitude: latitude,
                    longitude: longitude,
                    accuracy: position.coords.accuracy,
                    timestamp: new Date().toISOString(),
                    deviceFingerprint: generateDeviceFingerprint()
                };
                
                const response = await fetch('/api/attendance/clock', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('employeeToken')}`
                    },
                    body: JSON.stringify(attendanceData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification(`上班打卡成功！時間: ${result.data.clockTime}`, 'success');
                    updateTodayStatus('已打卡 - 上班', result.data.clockTime);
                    await loadAttendanceRecords(); // 刷新考勤記錄
                    updateGPSStatus('已定位', 'success');
                } else {
                    showNotification(`打卡失敗: ${result.error}`, 'error');
                    updateGPSStatus('打卡失敗', 'error');
                }
                
            } catch (error) {
                console.error('GPS打卡錯誤:', error);
                if (error.code === 1) {
                    showNotification('GPS定位被拒絕，請允許位置權限', 'warning');
                } else if (error.code === 2) {
                    showNotification('GPS定位不可用', 'warning');
                } else if (error.code === 3) {
                    showNotification('GPS定位超時', 'warning');
                } else {
                    showNotification(`打卡失敗: ${error.message}`, 'error');
                }
                updateGPSStatus('定位失敗', 'error');
            }
        }
        
        async function clockOut() {
            if (!navigator.geolocation) {
                showNotification('您的瀏覽器不支援GPS定位', 'error');
                return;
            }

            try {
                showNotification('正在獲取GPS位置...', 'info');
                
                const position = await getCurrentPosition();
                const { latitude, longitude } = position.coords;
                
                const attendanceData = {
                    type: 'clock_out',
                    latitude: latitude,
                    longitude: longitude,
                    accuracy: position.coords.accuracy,
                    timestamp: new Date().toISOString(),
                    deviceFingerprint: generateDeviceFingerprint()
                };
                
                const response = await fetch('/api/attendance/clock', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('employeeToken')}`
                    },
                    body: JSON.stringify(attendanceData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification(`下班打卡成功！時間: ${result.data.clockTime}`, 'success');
                    updateTodayStatus('已完成', result.data.clockTime);
                    await loadAttendanceRecords(); // 刷新考勤記錄
                    updateGPSStatus('已定位', 'success');
                } else {
                    showNotification(`打卡失敗: ${result.error}`, 'error');
                    updateGPSStatus('打卡失敗', 'error');
                }
                
            } catch (error) {
                console.error('GPS打卡錯誤:', error);
                showNotification(`打卡失敗: ${error.message}`, 'error');
                updateGPSStatus('定位失敗', 'error');
            }
        }
        
        // GPS定位Promise封裝
        function getCurrentPosition(options = {}) {
            return new Promise((resolve, reject) => {
                const defaultOptions = {
                    enableHighAccuracy: true,
                    timeout: 15000,
                    maximumAge: 300000 // 5分鐘
                };
                
                navigator.geolocation.getCurrentPosition(
                    resolve, 
                    reject, 
                    { ...defaultOptions, ...options }
                );
            });
        }
        
        // 設備指紋生成
        function generateDeviceFingerprint() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            ctx.textBaseline = 'top';
            ctx.font = '14px Arial';
            ctx.fillText('Device fingerprint', 2, 2);
            
            return {
                screen: `${screen.width}x${screen.height}`,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                language: navigator.language,
                platform: navigator.platform,
                userAgent: navigator.userAgent.substring(0, 100),
                canvas: canvas.toDataURL().substring(0, 100)
            };
        }
        
        // 更新GPS狀態顯示
        function updateGPSStatus(status, type) {
            const gpsElement = document.getElementById('gpsStatus');
            if (gpsElement) {
                const badgeClass = {
                    'success': 'bg-success',
                    'error': 'bg-danger', 
                    'warning': 'bg-warning',
                    'info': 'bg-info'
                }[type] || 'bg-secondary';
                
                gpsElement.innerHTML = `<span class="badge ${badgeClass}">${status}</span>`;
            }
        }
        
        function updateTodayStatus(status, time) {
            const statusElement = document.getElementById('todayStatus');
            if (statusElement) {
                statusElement.innerHTML = `
                    <span class="badge bg-success">${status}</span>
                    <p class="mb-0 mt-1">時間: ${time}</p>
                `;
            }
        }
        
        // 載入考勤記錄 - 真實API集成
        async function loadAttendanceRecords() {
            try {
                const response = await fetch('/api/attendance/records', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('employeeToken')}`
                    }
                });
                
                const result = await response.json();
                
                if (result.success && result.data) {
                    updateAttendanceTable(result.data);
                } else {
                    console.error('載入考勤記錄失敗:', result.error);
                }
                
            } catch (error) {
                console.error('載入考勤記錄錯誤:', error);
            }
        }
        
        // 更新考勤記錄表格
        function updateAttendanceTable(records) {
            const attendanceTable = document.querySelector('#attendance .table tbody');
            if (!attendanceTable) return;
            
            if (!records || records.length === 0) {
                attendanceTable.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center text-muted">暫無考勤記錄</td>
                    </tr>
                `;
                return;
            }
            
            attendanceTable.innerHTML = records.map(record => {
                const statusClass = getStatusClass(record.status);
                const clockOutTime = record.clockOutTime || '-';
                
                return `
                    <tr>
                        <td>${formatDate(record.clockInTime)}</td>
                        <td>${formatTime(record.clockInTime)}</td>
                        <td>${clockOutTime === '-' ? '-' : formatTime(record.clockOutTime)}</td>
                        <td><span class="badge ${statusClass}">${record.status || '正常'}</span></td>
                        <td>${record.workHours ? record.workHours + '小時' : '-'}</td>
                    </tr>
                `;
            }).join('');
        }
        
        // 狀態樣式映射
        function getStatusClass(status) {
            const statusMap = {
                '正常': 'bg-success',
                '遲到': 'bg-warning',
                '早退': 'bg-warning', 
                '異常': 'bg-danger',
                '進行中': 'bg-info'
            };
            return statusMap[status] || 'bg-secondary';
        }
        
        // 通知系統
        function showNotification(message, type = 'info') {
            // 移除舊通知
            const existingNotification = document.querySelector('.notification-toast');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            const typeClasses = {
                'success': 'alert-success',
                'error': 'alert-danger',
                'warning': 'alert-warning',
                'info': 'alert-info'
            };
            
            const notification = document.createElement('div');
            notification.className = `alert ${typeClasses[type]} notification-toast position-fixed`;
            notification.style.cssText = `
                top: 20px;
                right: 20px;
                z-index: 9999;
                max-width: 400px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            `;
            notification.innerHTML = `
                <i class="bi bi-${getNotificationIcon(type)}"></i>
                ${message}
                <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>
            `;
            
            document.body.appendChild(notification);
            
            // 3秒後自動消失
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }
        
        function getNotificationIcon(type) {
            const icons = {
                'success': 'check-circle',
                'error': 'exclamation-triangle',
                'warning': 'exclamation-circle',
                'info': 'info-circle'
            };
            return icons[type] || 'info-circle';
        }
        
        // 日期格式化
        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-TW');
        }
        
        // 時間格式化
        function formatTime(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleTimeString('zh-TW', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }
        
        // 排班查詢功能
        function loadSchedule() {
            const month = document.getElementById('scheduleMonth')?.value;
            console.log('載入排班資料:', month);
            showNotification('排班資料已更新', 'info');
        }
        
        // 請假申請功能
        function showLeaveModal() {
            // 創建請假申請模態框
            const modal = `
                <div class="modal fade" id="leaveModal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">請假申請</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="leaveForm">
                                    <div class="mb-3">
                                        <label class="form-label">請假類型</label>
                                        <select class="form-select" name="leaveType" required>
                                            <option value="">請選擇</option>
                                            <option value="annual">特休假</option>
                                            <option value="sick">病假</option>
                                            <option value="personal">事假</option>
                                        </select>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label class="form-label">開始日期</label>
                                            <input type="date" class="form-control" name="startDate" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">結束日期</label>
                                            <input type="date" class="form-control" name="endDate" required>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">請假原因</label>
                                        <textarea class="form-control" name="reason" rows="3" required></textarea>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                                <button type="button" class="btn btn-primary" onclick="submitLeave()">提交申請</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modal);
            new bootstrap.Modal(document.getElementById('leaveModal')).show();
        }
        
        function submitLeave() {
            const form = document.getElementById('leaveForm');
            const formData = new FormData(form);
            
            // 模擬API呼叫
            console.log('提交請假申請:', Object.fromEntries(formData));
            showNotification('請假申請提交成功，等待主管審核', 'success');
            
            // 關閉模態框
            bootstrap.Modal.getInstance(document.getElementById('leaveModal')).hide();
        }
        
        function viewLeave(id) {
            console.log('查看請假申請:', id);
            showNotification('查看請假申請詳情', 'info');
        }
        
        function cancelLeave(id) {
            if (confirm('確定要撤回此請假申請嗎？')) {
                console.log('撤回請假申請:', id);
                showNotification('請假申請已撤回', 'success');
            }
        }
        
        // 營收數據載入 - 真實API集成
        async function loadRevenueData() {
            try {
                showNotification('正在載入營收數據...', 'info');
                
                // 獲取營收摘要統計
                const summaryResponse = await fetch('/api/revenue/summary', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('employeeToken')}`
                    }
                });
                
                if (!summaryResponse.ok) {
                    throw new Error(`營收摘要API錯誤: ${summaryResponse.status}`);
                }
                
                const summaryData = await summaryResponse.json();
                
                if (summaryData.success) {
                    updateRevenueSummary(summaryData.data);
                }
                
                // 獲取日營收詳細數據
                const dailyResponse = await fetch('/api/revenue/daily', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('employeeToken')}`
                    }
                });
                
                if (dailyResponse.ok) {
                    const dailyData = await dailyResponse.json();
                    if (dailyData.success) {
                        updateDailyRevenueTable(dailyData.data);
                    }
                }
                
                showNotification('營收數據載入成功', 'success');
                
            } catch (error) {
                console.error('營收數據載入失敗:', error);
                showNotification('營收數據載入失敗: ' + error.message, 'error');
                
                // 載入失敗時顯示示例數據
                loadSampleRevenueData();
            }
        }
        
        // 更新營收摘要顯示
        function updateRevenueSummary(data) {
            const summaryContainer = document.getElementById('revenue-summary');
            if (!summaryContainer) {
                console.warn('營收摘要容器未找到');
                return;
            }
            
            summaryContainer.innerHTML = `
                <div class="row">
                    <div class="col-md-3">
                        <div class="card bg-primary text-white">
                            <div class="card-body">
                                <h5 class="card-title">今日營收</h5>
                                <h3>$${data.todayRevenue || 0}</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-success text-white">
                            <div class="card-body">
                                <h5 class="card-title">月營收</h5>
                                <h3>$${data.monthlyRevenue || 0}</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-info text-white">
                            <div class="card-body">
                                <h5 class="card-title">年營收</h5>
                                <h3>$${data.yearlyRevenue || 0}</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-warning text-white">
                            <div class="card-body">
                                <h5 class="card-title">成長率</h5>
                                <h3>${data.growthRate || 0}%</h3>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // 更新日營收表格
        function updateDailyRevenueTable(records) {
            const tableBody = document.getElementById('daily-revenue-table');
            if (!tableBody) {
                console.warn('日營收表格未找到');
                return;
            }
            
            if (!records || records.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" class="text-center">暫無營收記錄</td></tr>';
                return;
            }
            
            tableBody.innerHTML = records.map(record => `
                <tr>
                    <td>${record.date}</td>
                    <td>${record.storeName || '未指定'}</td>
                    <td class="text-end">$${record.amount}</td>
                    <td>
                        <span class="badge bg-${record.status === '已確認' ? 'success' : 'warning'}">
                            ${record.status || '待確認'}
                        </span>
                    </td>
                </tr>
            `).join('');
        }
        
        // 載入示例營收數據（API失敗時使用）
        function loadSampleRevenueData() {
            const sampleSummary = {
                todayRevenue: 45000,
                monthlyRevenue: 1350000,
                yearlyRevenue: 16200000,
                growthRate: 12.5
            };
            
            const sampleDailyRecords = [
                {
                    date: new Date().toISOString().split('T')[0],
                    storeName: '總店',
                    amount: 45000,
                    status: '已確認'
                },
                {
                    date: new Date(Date.now() - 86400000).toISOString().split('T')[0],
                    storeName: '分店A',
                    amount: 38000,
                    status: '已確認'
                }
            ];
            
            updateRevenueSummary(sampleSummary);
            updateDailyRevenueTable(sampleDailyRecords);
            showNotification('已載入示例營收數據', 'info');
        }
        
        // 營收記錄功能（保持向後兼容）
        function loadRevenue() {
            const month = document.getElementById('revenueMonth')?.value;
            console.log('載入營收資料:', month);
            // 調用新的API集成函數
            loadRevenueData();
        }
        
        // 績效分析功能
        function showPerformancePeriod(period) {
            console.log('切換績效分析期間:', period);
            // 更新按鈕狀態
            document.querySelectorAll('.btn-group .btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            showNotification(`已切換到${period === 'month' ? '月度' : period === 'quarter' ? '季度' : '年度'}分析`, 'info');
        }
        
        // 獎金查詢功能
        function downloadCommissionReport() {
            console.log('下載獎金報表');
            showNotification('正在準備下載獎金報表...', 'info');
            setTimeout(() => {
                showNotification('獎金報表下載完成', 'success');
            }, 2000);
        }
        
        // 個人資料功能
        function editProfile() {
            console.log('編輯個人資料');
            showNotification('個人資料編輯功能開發中...', 'warning');
        }
        
        // 薪資查詢功能
        function loadSalary() {
            const month = document.getElementById('salaryMonth')?.value;
            console.log('載入薪資資料:', month);
            showNotification('薪資資料已更新', 'info');
        }
        
        // 教育訓練功能
        function enrollTraining() {
            console.log('報名課程');
            showNotification('課程報名功能即將推出', 'info');
        }
        
        // 營收報表生成 - 真實API集成
        async function generateRevenueReport() {
            try {
                showNotification('正在生成營收報表...', 'info');
                
                const response = await fetch('/api/revenue/monthly', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('employeeToken')}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`營收報表API錯誤: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    displayRevenueReport(data.data);
                    showNotification('營收報表生成成功', 'success');
                } else {
                    throw new Error(data.message || '營收報表生成失敗');
                }
                
            } catch (error) {
                console.error('營收報表生成失敗:', error);
                showNotification('營收報表生成失敗: ' + error.message, 'error');
                
                // 生成示例報表
                generateSampleReport();
            }
        }
        
        // 顯示營收報表
        function displayRevenueReport(reportData) {
            const reportContainer = document.getElementById('revenue-report-container');
            if (!reportContainer) {
                // 如果容器不存在，創建一個
                const container = document.createElement('div');
                container.id = 'revenue-report-container';
                container.className = 'mt-4';
                const revenueSection = document.querySelector('#revenue-section .card-body');
                if (revenueSection) {
                    revenueSection.appendChild(container);
                }
            }
            
            const container = document.getElementById('revenue-report-container');
            if (container) {
                container.innerHTML = `
                    <h5>月度營收報表</h5>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>月份</th>
                                    <th>分店</th>
                                    <th class="text-end">營收金額</th>
                                    <th class="text-end">成長率</th>
                                    <th>狀態</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${reportData.map(item => `
                                    <tr>
                                        <td>${item.month}</td>
                                        <td>${item.storeName || '總計'}</td>
                                        <td class="text-end">$${item.revenue.toLocaleString()}</td>
                                        <td class="text-end">
                                            <span class="text-${item.growth >= 0 ? 'success' : 'danger'}">
                                                ${item.growth >= 0 ? '+' : ''}${item.growth}%
                                            </span>
                                        </td>
                                        <td>
                                            <span class="badge bg-${item.status === '已確認' ? 'success' : 'warning'}">
                                                ${item.status}
                                            </span>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }
        }
        
        // 生成示例報表（API失敗時使用）
        function generateSampleReport() {
            const sampleReportData = [
                {
                    month: '2025-08',
                    storeName: '總店',
                    revenue: 1350000,
                    growth: 12.5,
                    status: '進行中'
                },
                {
                    month: '2025-07',
                    storeName: '總店',
                    revenue: 1200000,
                    growth: 8.3,
                    status: '已確認'
                },
                {
                    month: '2025-06',
                    storeName: '總店',
                    revenue: 1108000,
                    growth: -2.1,
                    status: '已確認'
                }
            ];
            
            displayRevenueReport(sampleReportData);
            showNotification('已載入示例營收報表', 'info');
        }
        
        // 排班數據載入 - 真實API集成
        async function loadScheduleData() {
            try {
                showNotification('正在載入排班數據...', 'info');
                
                const employeeId = localStorage.getItem('employeeId');
                if (!employeeId) {
                    throw new Error('員工ID未找到，請重新登入');
                }
                
                const currentDate = new Date();
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth() + 1;
                
                // 獲取員工個人排程
                const response = await fetch(`/api/schedule/employee/${employeeId}/${year}/${month}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('employeeToken')}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`排班API錯誤: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    updateScheduleDisplay(data.data);
                    showNotification('排班數據載入成功', 'success');
                } else {
                    throw new Error(data.message || '排班數據載入失敗');
                }
                
            } catch (error) {
                console.error('排班數據載入失敗:', error);
                showNotification('排班數據載入失敗: ' + error.message, 'error');
                
                // 載入失敗時顯示示例數據
                loadSampleScheduleData();
            }
        }
        
        // 更新排班顯示
        function updateScheduleDisplay(scheduleData) {
            const scheduleContainer = document.getElementById('schedule-container');
            if (!scheduleContainer) {
                console.warn('排班容器未找到');
                return;
            }
            
            if (!scheduleData || scheduleData.length === 0) {
                scheduleContainer.innerHTML = '<div class="alert alert-info">本月暫無排班記錄</div>';
                return;
            }
            
            // 創建排班日曆視圖
            const calendarHTML = generateScheduleCalendar(scheduleData);
            scheduleContainer.innerHTML = calendarHTML;
        }
        
        // 生成排班日曆
        function generateScheduleCalendar(scheduleData) {
            const currentDate = new Date();
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth() + 1;
            const daysInMonth = new Date(year, month, 0).getDate();
            
            let calendarHTML = `
                <h5>${year}年${month}月 個人排班表</h5>
                <div class="table-responsive">
                    <table class="table table-bordered schedule-calendar">
                        <thead>
                            <tr>
                                <th>日期</th>
                                <th>星期</th>
                                <th>班別</th>
                                <th>時間</th>
                                <th>狀態</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            const weekdays = ['日', '一', '二', '三', '四', '五', '六'];
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month - 1, day);
                const dayOfWeek = weekdays[date.getDay()];
                const dateStr = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                
                // 查找該日期的排班記錄
                const daySchedule = scheduleData.find(s => s.date === dateStr);
                
                calendarHTML += `
                    <tr class="${daySchedule ? 'table-light' : ''}">
                        <td>${day}</td>
                        <td>${dayOfWeek}</td>
                        <td>${daySchedule ? daySchedule.shift : '<span class="text-muted">休息</span>'}</td>
                        <td>${daySchedule ? `${daySchedule.startTime}-${daySchedule.endTime}` : '-'}</td>
                        <td>
                            ${daySchedule ? 
                                `<span class="badge bg-${getScheduleStatusColor(daySchedule.status)}">${daySchedule.status}</span>` : 
                                '<span class="text-muted">-</span>'
                            }
                        </td>
                    </tr>
                `;
            }
            
            calendarHTML += `
                        </tbody>
                    </table>
                </div>
                <div class="mt-3">
                    <button class="btn btn-primary" onclick="submitScheduleRequest()">申請排班異動</button>
                    <button class="btn btn-outline-info" onclick="viewScheduleStatistics()">查看統計</button>
                </div>
            `;
            
            return calendarHTML;
        }
        
        // 載入示例排班數據
        function loadSampleScheduleData() {
            const currentDate = new Date();
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth() + 1;
            
            const sampleScheduleData = [];
            for (let day = 1; day <= 10; day++) {
                if (day % 7 !== 0) { // 跳過週日
                    sampleScheduleData.push({
                        date: `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`,
                        shift: day % 2 === 0 ? '早班' : '晚班',
                        startTime: day % 2 === 0 ? '09:00' : '14:00',
                        endTime: day % 2 === 0 ? '17:00' : '22:00',
                        status: '已確認'
                    });
                }
            }
            
            updateScheduleDisplay(sampleScheduleData);
            showNotification('已載入示例排班數據', 'info');
        }
        
        // 獲取排班狀態顏色
        function getScheduleStatusColor(status) {
            switch (status) {
                case '已確認': return 'success';
                case '待確認': return 'warning';
                case '衝突': return 'danger';
                default: return 'secondary';
            }
        }
        
        // 申請排班異動 - API集成
        async function submitScheduleRequest() {
            try {
                showNotification('正在提交排班異動申請...', 'info');
                
                const employeeId = localStorage.getItem('employeeId');
                const requestData = {
                    employeeId: employeeId,
                    requestType: 'schedule_change',
                    requestDate: new Date().toISOString().split('T')[0],
                    reason: '個人需求調整',
                    status: 'pending'
                };
                
                const response = await fetch('/api/schedule/employee', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('employeeToken')}`
                    },
                    body: JSON.stringify(requestData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        showNotification('排班異動申請提交成功，等待主管審核', 'success');
                    } else {
                        throw new Error(result.message || '申請提交失敗');
                    }
                } else {
                    throw new Error('API請求失敗');
                }
                
            } catch (error) {
                console.error('排班異動申請失敗:', error);
                showNotification('排班異動申請失敗: ' + error.message, 'error');
            }
        }
        
        // 查看排班統計 - API集成
        async function viewScheduleStatistics() {
            try {
                showNotification('正在載入排班統計...', 'info');
                
                const currentDate = new Date();
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth() + 1;
                
                const response = await fetch(`/api/schedule/statistics/${year}/${month}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('employeeToken')}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        displayScheduleStatistics(data.data);
                    }
                } else {
                    throw new Error('統計數據載入失敗');
                }
                
            } catch (error) {
                console.error('排班統計載入失敗:', error);
                showNotification('排班統計載入失敗: ' + error.message, 'error');
                
                // 顯示示例統計數據
                displayScheduleStatistics({
                    totalWorkDays: 22,
                    totalHours: 176,
                    overtimeHours: 8,
                    attendanceRate: 96
                });
            }
        }
        
        // 顯示排班統計
        function displayScheduleStatistics(statsData) {
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.innerHTML = `
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">排班統計</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <h5>總工作天數</h5>
                                            <h3 class="text-primary">${statsData.totalWorkDays || 0}</h3>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <h5>總工作時數</h5>
                                            <h3 class="text-success">${statsData.totalHours || 0}</h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <h5>加班時數</h5>
                                            <h3 class="text-warning">${statsData.overtimeHours || 0}</h3>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <h5>出勤率</h5>
                                            <h3 class="text-info">${statsData.attendanceRate || 0}%</h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            const bsModal = new bootstrap.Modal(modal);
            bsModal.show();
            
            modal.addEventListener('hidden.bs.modal', () => {
                modal.remove();
            });
        }
        
        // 投票系統API集成
        async function loadVotingData() {
            try {
                showNotification('正在載入投票數據...', 'info');
                
                const response = await fetch('/api/voting', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('employeeToken')}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`投票API錯誤: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    updateVotingDisplay(data.data);
                    showNotification('投票數據載入成功', 'success');
                } else {
                    throw new Error(data.message || '投票數據載入失敗');
                }
                
            } catch (error) {
                console.error('投票數據載入失敗:', error);
                showNotification('投票數據載入失敗: ' + error.message, 'error');
                
                // 載入失敗時顯示示例數據
                loadSampleVotingData();
            }
        }
        
        // 更新投票顯示
        function updateVotingDisplay(votingData) {
            const votingContainer = document.getElementById('voting-container');
            if (!votingContainer) {
                console.warn('投票容器未找到');
                return;
            }
            
            if (!votingData || votingData.length === 0) {
                votingContainer.innerHTML = '<div class="alert alert-info">目前沒有進行中的投票</div>';
                return;
            }
            
            votingContainer.innerHTML = votingData.map(vote => `
                <div class="card mb-3">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">${vote.title}</h6>
                        <span class="badge bg-${vote.status === 'active' ? 'success' : 'secondary'}">${vote.status === 'active' ? '進行中' : '已結束'}</span>
                    </div>
                    <div class="card-body">
                        <p class="card-text">${vote.description}</p>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <small class="text-muted">候選人: ${vote.candidate}</small>
                            </div>
                            <div class="col-md-6">
                                <small class="text-muted">職位: ${vote.position}</small>
                            </div>
                        </div>
                        <div class="vote-stats mb-3">
                            <div class="d-flex justify-content-between">
                                <span>贊成: ${vote.votes_for || 0}</span>
                                <span>反對: ${vote.votes_against || 0}</span>
                            </div>
                            <div class="progress mt-2">
                                <div class="progress-bar bg-success" style="width: ${getVotePercentage(vote.votes_for, vote.votes_against, 'for')}%"></div>
                                <div class="progress-bar bg-danger" style="width: ${getVotePercentage(vote.votes_for, vote.votes_against, 'against')}%"></div>
                            </div>
                        </div>
                        ${vote.status === 'active' ? `
                            <div class="d-flex gap-2">
                                <button class="btn btn-success" onclick="submitVote('${vote.id}', 'for')">
                                    <i class="bi bi-hand-thumbs-up"></i> 贊成
                                </button>
                                <button class="btn btn-danger" onclick="submitVote('${vote.id}', 'against')">
                                    <i class="bi bi-hand-thumbs-down"></i> 反對
                                </button>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }
        
        // 計算投票百分比
        function getVotePercentage(votesFor, votesAgainst, type) {
            const total = (votesFor || 0) + (votesAgainst || 0);
            if (total === 0) return 0;
            
            if (type === 'for') {
                return Math.round((votesFor / total) * 100);
            } else {
                return Math.round((votesAgainst / total) * 100);
            }
        }
        
        // 提交投票
        async function submitVote(voteId, voteType) {
            try {
                showNotification('正在提交投票...', 'info');
                
                const response = await fetch(`/api/voting/${voteId}/vote`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('employeeToken')}`
                    },
                    body: JSON.stringify({
                        vote_type: voteType
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        showNotification(`投票提交成功: ${voteType === 'for' ? '贊成' : '反對'}`, 'success');
                        // 重新載入投票數據
                        await loadVotingData();
                    } else {
                        throw new Error(result.message || '投票提交失敗');
                    }
                } else {
                    throw new Error('投票API請求失敗');
                }
                
            } catch (error) {
                console.error('投票提交失敗:', error);
                showNotification('投票提交失敗: ' + error.message, 'error');
            }
        }
        
        // 載入示例投票數據
        function loadSampleVotingData() {
            const sampleVotingData = [
                {
                    id: 'vote001',
                    title: '員工升遷投票 - 張小明',
                    description: '張小明申請升職為店長助理，請各位同事投票表決',
                    candidate: '張小明',
                    position: '店長助理',
                    status: 'active',
                    votes_for: 15,
                    votes_against: 3,
                    created_at: new Date().toISOString(),
                    end_date: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString()
                },
                {
                    id: 'vote002',
                    title: '降職投票 - 遲到違規處理',
                    description: '針對連續遲到員工的降職投票',
                    candidate: '李小華',
                    position: '降級處理',
                    status: 'active',
                    votes_for: 8,
                    votes_against: 12,
                    created_at: new Date(Date.now() - 86400000).toISOString(),
                    end_date: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString()
                }
            ];
            
            updateVotingDisplay(sampleVotingData);
            showNotification('已載入示例投票數據', 'info');
        }
        
        // 報表功能
        function generateReport() {
            const reportType = document.getElementById('reportType')?.value;
            const startDate = document.getElementById('reportStartDate')?.value;
            const endDate = document.getElementById('reportEndDate')?.value;
            
            console.log('生成報表:', { reportType, startDate, endDate });
            showNotification('正在生成報表，請稍候...', 'info');
            
            setTimeout(() => {
                showNotification('報表生成完成', 'success');
            }, 2000);
        }
        
        function exportReport(format) {
            console.log('匯出報表:', format);
            showNotification(`正在匯出${format.toUpperCase()}格式報表...`, 'info');
        }
        
        // 通知中心功能
        function markAllAsRead() {
            console.log('標記所有通知為已讀');
            document.querySelectorAll('.notification-item.unread').forEach(item => {
                item.classList.remove('unread');
            });
            showNotification('所有通知已標為已讀', 'success');
        }
        
        function markAsRead(id) {
            console.log('標記通知為已讀:', id);
            event.target.closest('.notification-item').classList.remove('unread');
            showNotification('通知已標為已讀', 'success');
        }
        
        function filterNotifications(filter) {
            console.log('篩選通知:', filter);
            // 更新按鈕狀態
            document.querySelectorAll('.btn-group .btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            showNotification(`已切換到${filter === 'all' ? '全部' : filter === 'unread' ? '未讀' : '重要'}通知`, 'info');
        }
        
        // 系統設定功能
        function saveSettings() {
            console.log('保存系統設定');
            showNotification('系統設定已保存', 'success');
        }
        
        function resetSettings() {
            if (confirm('確定要重置為預設設定嗎？')) {
                console.log('重置系統設定');
                showNotification('系統設定已重置為預設值', 'success');
            }
        }
        
        // 通用通知功能（已存在的函數，確保不重複）
        if (typeof showNotification === 'undefined') {
            function showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
                notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
                notification.innerHTML = `
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;

                document.body.appendChild(notification);

                // 3秒後自動消失
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 3000);
            }
        }
        
        // 初始化完整功能模組
        document.addEventListener('DOMContentLoaded', function() {
            console.log('✅ 員工系統完整功能模組已載入');
            
            // 初始化圖表（如果Chart.js可用）
            if (typeof Chart !== 'undefined') {
                initializeAllCharts();
            }
            
            // 初始化GPS狀態
            updateGPSStatus();
        });
        
        // GPS狀態更新
        function updateGPSStatus() {
            const gpsStatus = document.getElementById('gpsStatus');
            if (gpsStatus && navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        gpsStatus.innerHTML = '<span class="badge bg-success">GPS已定位</span>';
                    },
                    function(error) {
                        gpsStatus.innerHTML = '<span class="badge bg-warning">GPS無法定位</span>';
                    }
                );
            }
        }
        
        // 初始化所有圖表
        function initializeAllCharts() {
            // 這裡可以添加各種圖表的初始化代碼
            console.log('初始化圖表組件');
        }
        
    </script>
</body>
</html>