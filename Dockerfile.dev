# ğŸš§ Development Dockerfile with hot reload
FROM node:18-alpine

# å®‰è£é–‹ç™¼å·¥å…·
RUN apk add --no-cache \
    sqlite \
    curl \
    git \
    vim \
    && rm -rf /var/cache/apk/*

# è¨­ç½®å·¥ä½œç›®éŒ„
WORKDIR /app

# å®‰è£å…¨å±€é–‹ç™¼ä¾è³´
RUN npm install -g nodemon pm2

# è¤‡è£½ package æ–‡ä»¶
COPY package*.json ./

# å®‰è£æ‰€æœ‰ä¾è³´ï¼ˆåŒ…æ‹¬é–‹ç™¼ä¾è³´ï¼‰
RUN npm install

# å‰µå»ºé–‹ç™¼ç”¨æˆ¶
RUN addgroup -g 1001 -S nodejs && \
    adduser -S nodeuser -u 1001

# å‰µå»ºç›®éŒ„
RUN mkdir -p logs uploads database && \
    chown -R nodeuser:nodejs /app

# åˆ‡æ›ç”¨æˆ¶
USER nodeuser

# æš´éœ²ç«¯å£
EXPOSE 3000 9229

# é–‹ç™¼æ¨¡å¼å•Ÿå‹•
CMD ["npm", "run", "dev"]